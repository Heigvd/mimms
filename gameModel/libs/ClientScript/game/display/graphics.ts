import { getAfflictedBlocks } from "./currentPatientZoom";
import { interpolate, normalize } from "../../tools/helper";
import { Point } from "../../map/point2D";
import { BlockName, BodyPosition, Glasgow, HumanBody } from "../../HUMAn/human";
import { getCurrentPatientBody, getHuman } from "../logic/the_world";
import { Categorization, Category, getCategory } from "../logic/triage";
import { convertMeterToMapUnit } from "../../map/layersData";
import { getTranslation } from "../../tools/translation";

export interface HumanOverview {
	height_cm: number;
	gcs: Glasgow,
	position: BodyPosition;
	colorful: number;
	cyanosis: boolean;
	looksDead: boolean;
	totalExternalBloodLosses_ml: number;
	venousBloodLosses_mlPerMin: number;
	arterialBloodLosses_mlPerMin: number;
	category: Category<string> | undefined;
	rr: number;
	tidalVolume_L: number;
}

/**
 * Category Card SVG
 */
function getCategoryCardSvg(category: Category<string> | undefined, x: number | string = 0, y: number|string = 0, size: number|string = 4): string {
		return `<svg width="${size}" height="${size}" stroke-width="3.5%" viewBox="-10 -10 150 150" fill="none" x=${x} y=${y} xmlns="http://www.w3.org/2000/svg">
<path d="M0.5 64.0144V12.1875C0.5 5.73259 5.73259 0.5 12.1875 0.5H64.0144C67.1141 0.500016 70.0868 1.73139 72.2786 3.92322L126.077 57.7214C130.641 62.2856 130.641 69.6858 126.077 74.25L74.25 126.077C69.6858 130.641 62.2856 130.641 57.7214 126.077L3.92322 72.2786C1.73139 70.0868 0.500016 67.1141 0.5 64.0144ZM28.4375 15.75C21.4303 15.75 15.75 21.4303 15.75 28.4375C15.75 35.4447 21.4303 41.125 28.4375 41.125C35.4447 41.125 41.125 35.4447 41.125 28.4375C41.125 21.4303 35.4447 15.75 28.4375 15.75Z" stroke="black" fill="${category?.bgColor}"/>
</svg>`
}

interface PictoConfig {
	className: string;
	bloodRatio: number
}

function getPicoClassNames(overview: HumanOverview): PictoConfig {
	const classes: string[] = [];

	const bloodRatio = normalize(overview.totalExternalBloodLosses_ml / 500, { max: 1 });
	if (overview.totalExternalBloodLosses_ml > 0) {
		classes.push("blood");
	}

	return {
		className: classes.join(" "),
		bloodRatio: bloodRatio,
	};
}

interface PictoOptions {
	height_px: number;
	classes: string;
	bloodStyle: string;
	category: Category<string> | undefined;
	offset: boolean;
}

function getStanding({ height_px, classes, bloodStyle, category, offset }: PictoOptions) {
	const left = offset ? -0.51 * height_px : 0;
	const top = offset ? -0.97 * height_px : 0;
	return `<svg style="position: relative; left: ${left}px; top:${top}px;" class="body_picto ${classes}" height="${height_px}" viewBox="0 0 600 600" fill="black" xmlns="http://www.w3.org/2000/svg">
    			<path style="${bloodStyle} transform-origin:50% 97%;" class="blood" d="M294,541.15s-30.72-2.98-38.99,0c-8.27,2.98-37.81,12.18-33.09,21.37,4.73,9.19,38.99,15.76,48.45,15.76s21.27,14.44,37.81,14.44,52.66-10.5,69.46-11.82c16.8-1.31,54.93-6.94,54.18-14.63-.75-7.69-22.57-17.33-37.66-16.45-15.09,.88-21.46-10.34-36.59-8.67-15.13,1.67-45.82,1.17-63.58,0Z" 
				fill="#d11c1c"/>
				<g>
				<path d="M326.53,65.08c-.13,1.4,.08,2.82,.27,4.19,.08,.52,.15,1.05,.2,1.59-.01,0-.01,.01-.03,.01-.04,.01-.04,.06-.03,.09,.01,.01,.04,.03,.05,.03h.01c.05,.43,.08,.86,.09,1.29,.11,6.06-3.28,12.83-10.07,20.11-.54,.58-1.1,1.16-1.67,1.73-4.1,4.07-8.83,7.4-13.84,5.59-2.4-.87-6.06-3.02-9.05-5.3h-.01s-.03-.03-.04-.03c-1.65-1.28-3.08-2.57-3.99-3.71-4.11-5.19-8.1-10.79-7.69-17.11,.06-.89,.11-1.78,.15-2.68,.13-2.28,.22-4.51,.27-6.31,.08-3.38-.39-6.25-.85-9.04-.43-2.68-.87-5.45-.87-8.74,.03-6.93,4.67-13.98,9.25-17.36,6.38-4.7,12.06-5.92,20.96-4.52,8.76,1.39,14.84,6.16,17.16,13.45,1.85,5.88,2.7,14.97,.59,20.26-.61,1.54-.67,3.01-.75,4.57-.03,.61-.05,1.24-.11,1.89Z" 
				style="stroke:#fff; stroke-miterlimit:10;"/>
				<path d="M281.04,63.82c0,.25-.01,.51-.01,.76-.04,1.73-.13,3.89-.25,6.07-.39-.78-.81-1.65-1-2.49l-.82-3.53c-.44-1.85-.92-3.94-.65-5.95,.06-.43,.19-1.08,.58-1.54,.32-.38,.91-.68,1.46-.47h.01c.38,2.3,.68,4.54,.68,7.15Z" style="stroke:#fff; stroke-miterlimit:10;"/>
				<path d="M328.96,63.42c-.09,.58-.19,1.19-.27,1.73-.05,.46-.06,.92-.09,1.37-.03,.58-.05,1.18-.15,1.76-.13,.65-.43,1.82-1.34,2.48-.05-.51-.11-1.01-.19-1.51-.19-1.37-.39-2.77-.27-4.16,.06-.66,.09-1.28,.11-1.89,.08-1.54,.14-3.01,.75-4.54,.06-.16,.13-.32,.18-.49h.01c.52,0,.91,.15,1.18,.47,.75,.87,.41,2.86,.08,4.78Z" style="stroke:#fff; stroke-miterlimit:10;"/>
				<path d="M373.05,317.71c-.49,1.48-1.51,2.68-2.48,3.86-.84,.99-1.53,2.37-2.21,3.7-.67,1.33-1.38,2.7-2.19,3.68-2.24,2.68-4.77,4.73-7.54,6.18-.03,0-.05,.01-.05,.03-1.77,.9-3.64,1.56-5.62,1.94-2.28,.44-5.01-.22-5.61-2.3-.71-2.49,2.05-4.38,4.28-5.88,.14-.09,.27-.19,.41-.28,1.18-.81,2.24-1.78,3.14-2.9,1.85-2.29,3.11-4.95,3.67-7.71,.13-.63,.22-1.28,.28-1.92,.25-2.94-.28-5.96-1.63-9.23-.03-.06-.06-.15-.13-.2-.25-.22-.73,.16-.95,.32l-.03,.03c-.27,.2-.51,.46-.72,.76-.38,.52-.66,1.16-.86,1.92-.61,2.3-.39,4.73-.18,7.07,.03,.35,.06,.72,.09,1.08,.14,1.82,.22,3.7,.28,5.49,.01,.3,.01,.63-.19,.81-.19,.18-.48,.16-.71,.13-.89-.16-1.57-.85-1.99-1.4-.28-.35-.52-.75-.75-1.13-.11-.19-.23-.39-.35-.58-.41-.62-.66-1.13-.84-1.66-.35-1.04-.46-2.15-.56-3.23l-.03-.33c-.68-7.53,.9-13.43,5.14-19.12,1.27-1.7,4.28-5.97,4.94-9.17,1.01-4.99-.22-12.69-3.78-23.56-2.25-6.9-3.83-12.3-4.95-18.35v-.03c-.3-1.68-.57-3.42-.81-5.25-.27-2-.78-4.56-1.35-7.28-1.23-6-2.77-13.48-2.2-18.88,.57-5.34,.35-9.79,.14-14.53-.11-2.25-.22-4.58-.25-7.12-.05-4.39-.19-8.86-.33-13.19-.29-9.87-.61-20.07,0-30.11,.04-.52,.01-1.29-.03-2.19-.09-2.24-.19-5.32,.63-6.3,.03-.04,.03-.08,0-.09-.03-.03-.06-.03-.09,0-.87,1.04-.76,4.01-.67,6.39,.04,.9,.06,1.67,.03,2.19-.61,10.04-.29,20.24,0,30.11,.14,4.33,.28,8.8,.33,13.2,.04,2.53,.14,4.87,.25,7.12,0,.13,.01,.27,.01,.39-.56,.82-2.11,6.15-2.25,7.14-.05,.37-.1,.75-.15,1.11-.52,3.73-1.05,7.61-.72,11.43,.32,3.76,1.42,7.43,2.49,10.98,.11,.39,.23,.78,.35,1.18,1.19,4.02,2.51,8.31,4.07,12.45,.05,.15,.13,.37,.2,.59,.08,.24,.15,.48,.22,.66,0,.01,.01,.03,.01,.04,1.11,6.06,2.68,11.47,4.95,18.36,3.56,10.85,4.78,18.53,3.77,23.5-.65,3.18-3.64,7.44-4.91,9.12-4.26,5.72-5.86,11.64-5.16,19.21l.03,.33c.1,1.09,.2,2.2,.56,3.26,.19,.53,.46,1.05,.86,1.68,.11,.19,.23,.38,.35,.57,.23,.38,.47,.77,.75,1.14,.43,.57,1.14,1.28,2.08,1.46,.34,.06,.62,.01,.8-.15,.25-.23,.25-.59,.24-.91-.06-1.81-.14-3.67-.28-5.5-.03-.35-.06-.72-.09-1.08-.22-2.34-.43-4.75,.18-7.02,.19-.75,.47-1.38,.84-1.89,.2-.3,.44-.54,.7-.73l.03-.03c.42-.3,.68-.42,.78-.33,.05,.05,.08,.1,.1,.16,1.34,3.25,1.87,6.25,1.62,9.17-.06,.63-.15,1.28-.28,1.9-.56,2.73-1.81,5.38-3.64,7.64-.89,1.11-1.94,2.09-3.11,2.89-.13,.09-.27,.18-.39,.28-2.27,1.53-5.07,3.43-4.34,6.02,.49,1.75,2.42,2.52,4.35,2.52,.47,0,.95-.04,1.4-.13,1.96-.38,3.81-1.03,5.58-1.91-.25,11.12-3.1,23.83-5.86,36.12-1.39,6.21-2.71,12.07-3.64,17.57-1.89,10.9-2.71,22.29-2.46,33.88,.09,4.2,.24,8.34,.38,12.33,.53,14.34,1.03,27.88-1.28,42.9-.91,5.92-1.73,12.24-2.67,20.45-.97,8.44-2.48,16.94-3.92,25.16-.19,1.06-.38,2.13-.57,3.19-.11,.65-.23,1.29-.34,1.92-1.52,8.49-2.95,16.51,.2,24.84,2.01,5.3,5.06,10.14,8,14.81l.14,.22c.09,.14,.22,.29,.35,.47,.8,.99,2.28,2.82,.73,6.05-.89,1.86-2.99,1.94-4.38,1.99-.52,.01-.92,.03-1.15,.13-6.91,3.04-11.72,2.76-18.2,1.18-5.14-1.25-9.16-2.4-10.29-4.99-.57-1.32-.33-2.89,.75-4.82,.62-1.13,1.39-2.19,2.13-3.21,.91-1.27,1.85-2.58,2.54-4.01,1.46-3.01,1.76-6.54,1.85-9.59,.32-9.43-.7-18.86-1.76-27.71-.44-3.76-.81-7.61-1.15-11.33-.48-5.06-.96-10.28-1.68-15.38-.73-5.19-1.25-9.38-1.62-13.2-1.08-11.05-1.9-24.25,.08-38.31,1.21-8.62,.39-18.21-2.58-30.21-1.96-7.91-2.73-16.05-3.18-22.26-1.01-14.06-1.73-28.27-2.43-42.03-.7-13.74-1.42-27.96-2.43-42.03h-.13c-1.06,10.44-1.62,21.16-2.15,31.52s-1.09,21.08-2.15,31.51c-.8,7.9-1.92,15.14-3.02,22.13-1.73,11.12-3.38,21.63-3.38,32.9,0,1.94,.29,4.82,.66,8.48,.84,8.44,2,20.02,.92,32.03-.71,7.92-1.78,15.82-2.83,23.46-.24,1.77-.53,3.56-.82,5.29-.24,1.49-.49,3.05-.72,4.57-.3,2.14-.42,4.29-.52,6.38-.06,1.1-.13,2.23-.2,3.34-.53,6.83-1.03,13.92-1.47,21.06-.25,4.16-.43,7.66-.48,11.17-.11,7.96,.92,14.36,3.29,20.13,.16,.4,.33,.8,.51,1.2,1.19,2.82,2.42,5.73,1.77,8.67-.15,.67-.38,1.15-.7,1.47-.37,.37-.89,.56-1.34,.71-3.27,1.16-6.64,2.35-10.12,2.89-5.14,.8-10.28,.2-16.41-.95-1.58-.29-3.09-.65-4.1-1.76-1.37-1.51-1.24-3.81-1.04-5.05,.49-3.1,2.14-5.85,3.71-8.52,.33-.54,.66-1.1,.97-1.66,5.43-9.48,7.39-21.27,6-36.08-.61-6.49-1.73-12.81-2.87-18.65-.66-3.43-1.1-6.88-1.53-10.24-.35-2.78-.73-5.66-1.23-8.52-.1-.62-.22-1.25-.32-1.87-.51-2.86-1.03-5.81-1.44-8.72-1.33-9.2-2.15-17.34-2.51-24.88-.25-5.11-.3-10.3-.16-15.43,.08-2.78,.33-6.14,.61-9.69,.63-8.2,1.34-17.5,.14-23.82-.27-1.42-.54-3.01-.84-4.69-.86-4.99-1.82-10.62-3.14-14.64-4.11-12.54-8.43-32.95-7.04-49.23,1.1,.46,2.2,.86,3.26,1.25l.19,.06c1.39,.52,2.73,1.01,4.01,1.01,.95,0,1.86-.28,2.72-1.04,2.01-1.77,2.3-3.24,1.04-5.25-1.24-1.97-3.16-4.51-5.3-5.4-1.99-.84-3.75-2.49-4.71-4.44-1.62-3.25-2.61-8.81-1.48-11.88,.13-.34,.38-1.38,.43-1.8,2.61,.48,4.68,3.75,4.91,6.4,.05,.67,.08,1.35,.1,2.02,.06,2.06,.14,4.21,1.19,6,.41,.71,.9,1.15,1.44,1.34,.63,.22,1.48,0,1.76-.66,1.65-3.99,1.46-10.12-.58-18.24-.94-3.73-4.96-7.77-7.37-10.19-1.06-1.06-1.9-1.9-2.02-2.25-.53-1.54,2.28-15.31,3.96-23.55l.22-1.05c1.21-5.99,2.75-14.26,4.24-22.56,.68-2.44,1.38-4.54,2.05-6.56,.84-2.49,1.62-4.85,2.38-7.81l.2-.8c1-3.9,2.38-9.25,2.38-13.09,0-1.96-.28-4.66-.56-7.26-.13-1.2-.25-2.34-.34-3.4,.75-9.83,1.14-19.75,1.16-29.57,.04-9.92-.24-21.39-4.09-31.87-.01-.03-.05-.05-.09-.04-.03,.01-.05,.05-.04,.09,3.85,10.45,4.13,21.91,4.09,31.81-.03,9.82-.42,19.75-1.16,29.59-.16,2.29-.35,4.57-.57,6.85-.04,.24-2.71,16.19-5.54,32.03h0c-1.49,8.31-3.02,16.58-4.24,22.56l-.2,1.05c-1.8,8.78-4.51,22.05-3.96,23.61,.13,.38,.94,1.19,2.05,2.32,2.39,2.39,6.4,6.42,7.33,10.11,2.02,8.1,2.23,14.2,.59,18.16-.25,.59-1.03,.78-1.61,.58-.52-.16-.97-.59-1.38-1.28-1.03-1.76-1.1-3.89-1.16-5.94-.03-.67-.05-1.37-.1-2.04-.24-2.73-2.38-6.09-5.09-6.53h-.06s-.01,.05-.01,.05c-.03,.35-.29,1.49-.42,1.84-1.18,3.21-.15,8.72,1.48,11.98,.97,1.97,2.76,3.66,4.77,4.51,2.23,.94,4.24,3.76,5.24,5.35,1.23,1.95,.94,3.38-1.01,5.1-1.95,1.72-4.1,.92-6.59,0l-.19-.08c-1.08-.39-2.2-.8-3.32-1.27-.01-.01-.03-.01-.05-.03h-.01c-2.97-1.23-5.94-2.8-8.07-5.3-3.37-3.95-4.07-9.25-4.59-15.27-.2-2.23-.25-4.37-.3-6.43-.08-2.43-.14-4.92-.43-7.56-.1-.89-.22-1.58-.32-2.19-.32-1.96-.46-2.85,.71-5.45,.16-.37,.35-.72,.54-1.08,.29-.58,.61-1.16,.82-1.8,.71-2.1,.67-7.85,.27-10.21-2.16-12.48-3.95-27.2-.85-41.62,3.7-17.15,4.81-34.66,5.64-51.14,.33-6.56,.33-11.96,0-17-.15-2.23-.49-4.49-.84-6.68-.52-3.32-1.05-6.74-.87-10.11,.06-1.33,.08-2.67,.09-3.97,.03-3.14,.05-6.38,.87-9.52,1.39-5.38,5.3-10.48,11.01-14.38,2.97-2.02,6.43-3.26,9.77-4.45,.81-.29,1.65-.58,2.46-.89,1.19-.44,2.4-.89,3.58-1.3,4.76-1.71,9.68-3.48,14.02-6.21,2.67-1.67,4.51-3.34,5.78-5.26,2.18-3.24,2.72-7.56,3.2-11.38,2.99,2.27,6.62,4.39,9.01,5.26,.92,.33,1.87,.51,2.85,.51,1.86,0,3.82-.62,5.85-1.83,1.89-1.13,3.61-2.63,5.14-4.15-1.08,6.57,6.21,13.49,10.15,17.24,3.89,3.68,7.25,6.15,12.09,7.01,4.91,.89,16.27,1.77,16.38,1.77,8.06,1.37,10.87,10.36,11.69,14.16,.23,1,.27,2.02,.32,3.02,.01,.42,.04,.86,.08,1.29,.09,1.27,.23,2.57,.34,3.82,.15,1.52,.3,3.1,.42,4.64,.06,1.11,.16,2.23,.27,3.3,.15,1.66,.32,3.38,.37,5.07,.14,4.73-.08,9.53-.29,14.17-.19,3.92-.38,7.99-.34,11.98,.05,6.31,.03,12.76,.01,18.98-.01,2.29-.03,4.57-.03,6.86,0,1.96,0,4,.39,5.95,.23,1.13,.66,2.89,1.11,4.73,.59,2.38,1.2,4.82,1.46,6.26,3.08,17.82,4.91,30.64,2.58,45.86-1.48,9.63-2.29,18.12-1.4,28.23,.25,2.96,.75,5.21,1.21,7.38,.47,2.11,.95,4.3,1.21,7.18,.14,1.47,.2,3.01-.27,4.43Z" 
				stroke="#fff" stroke-miterlimit="10"/>
</g>
		${getCategoryCardSvg(category, '49%', '18%', 40)}
    </g>
</svg>`;
}


function getSitting({ height_px, classes, bloodStyle, category, offset }: PictoOptions) {
	const left = offset ? -0.635 * height_px : 0;
	const top = offset ? -0.6 * height_px : 0;
	return `<svg style="position: relative; left: ${left}px; top:${top}px;" class="body_picto ${classes}" height="${height_px}" viewBox="0 0 600 600" fill="black" xmlns="http://www.w3.org/2000/svg">
    <path style="${bloodStyle}; transform-origin:65% 65%;" class="blood" d="M297.97,400.21s-30.72-2.98-38.99,0c-8.27,2.98-37.81,12.18-33.09,21.37,4.73,9.19,38.99,15.76,48.45,15.76s21.27,14.44,37.81,14.44,52.66-10.5,69.46-11.82c16.8-1.31,54.93-6.94,54.18-14.63-.75-7.69-22.57-17.33-37.66-16.45-15.09,.88-21.46-10.34-36.59-8.67-15.13,1.67-45.82,1.17-63.58,0Z" 
fill="#d11c1c"/>
	<g class="sitting_position">	
	<path d="M342.85,320.68c-.61,3.42-1.65,7.56-2.89,11.86v.02c-2.42,8.3-5.58,17.22-7.76,22.79-.86,2.18-3.21,6.58-6.33,12.12-.01,.01-.01,.02-.01,.03-5.48,9.69-13.32,22.78-19.67,33.4-3.35,5.59-6.24,10.43-8.25,13.86l-1.17,2.7c-1.49,2.89-4.11,8.16-5.49,11.06l-.47,2.1h0c.16,4.57,.41,8.69,.8,13.35,.48,5.75-.08,9.61-4.39,12.3-2.34,1.47-5.12,2.84-7.8,4.16-1.5,.74-2.9,1.44-4.24,2.16-2.85,1.51-5.23,3.79-7.53,6-2.27,2.17-4.61,4.42-7.4,5.93-6.18,3.35-13.4,2.78-21.52,1.77-4.56-.57-8.88-1.33-11.72-4.28-.6-.63-.97-1.19-1.16-1.78-.26-.82-.18-1.82,.24-2.81,1.41-3.45,5.03-4.57,8.85-5.75,2.14-.66,4.34-1.34,6.17-2.46,1.77-1.09,3.21-2.62,4.59-4.11l11.81-12.69c2.08-2.23,4.44-4.76,5.72-7.8,1.15-2.75,1.59-4.31,2.31-6.89,.1-.34,.2-.7,.3-1.08,.48-1.71,1.17-3.62,2.59-4.82,.44-.36,.92-.69,1.38-1,.35-.25,.72-.49,1.07-.75,1.29-1,4.41-7.48,6.11-11.54l.75-2.26c3-7.75,13.29-34.72,18.93-51.19h.01s.01-.03,.01-.05c1.74-5.07,3.04-9.16,3.56-11.36l.12-.35c2.21-.62,4.28-1.77,5.64-2.62,.27-.18,.55-.35,.83-.53,2.41-1.47,4.91-3.02,5.07-5.83,1.53-2.04,7.49-4.05,12.77-5.83,2.55-.87,4.96-1.69,6.81-2.46,3.95-1.68,7.72-3.48,11.36-5.39Z" 
	stroke="#fff" stroke-miterlimit="10"/>
	<path d="M422.42,344.08c.21,5.56,.18,10.72-.11,15.36-.71,11.03-6.85,21.31-16.85,28.21-9.39,6.47-22.02,8.4-32.92,5.02-3.8-1.17-6.75-2.76-8.99-4.85-4.91-4.57-6.39-11.39-7.83-17.99-.69-3.16-1.4-6.44-2.48-9.45-1.34-3.71-3.31-7.22-5.22-10.61-.57-1.01-1.17-2.07-1.73-3.11-2.41-4.42-4.16-8.69-6.21-14.12,1.25-4.33,2.3-8.49,2.9-11.93,11.06-5.83,20.96-12.71,31.11-20.28,10.89,10.6,22.07,21.59,30.38,30.33,9.3,9.81,13.64,15.41,12.87,16.68-.02,.02-.01,.06,.01,.07,.01,.01,.02,.01,.03,.01,.02,0,.03-.01,.05-.02,.81-1.33-3.41-6.83-12.88-16.82-8.3-8.73-19.47-19.73-30.37-30.33,2.13-1.59,4.26-3.21,6.44-4.86,1.05-.8,2.24-1.71,3.03-2.89,.81-1.23,1.17-2.68,1.52-4.1l.03-.16c3.47-13.95,9.68-25.99,16.26-38.74,1.95-3.77,3.95-7.66,5.86-11.57,1.98-4.04,4.33-9.35,5-14.56,.73-5.81-.7-10.42-4.38-14.09-.02-.02-.06-.02-.08,0-.02,.02-.02,.06,0,.08,7.88,7.85,4.1,18.82-.64,28.51-1.91,3.92-3.92,7.81-5.86,11.58-6.58,12.75-12.8,24.78-16.26,38.75l-.05,.17c-.35,1.4-.71,2.85-1.51,4.05-.78,1.17-1.96,2.07-2.99,2.87-2.17,1.65-4.31,3.29-6.45,4.88-.08-.09-.17-.17-.25-.25-.02-.02-.06-.02-.08,0s-.02,.06,0,.08l.24,.24c-10.13,7.57-20.04,14.45-31.07,20.26-.02,0-.03,.01-.05,.02-3.68,1.94-7.47,3.75-11.44,5.43-1.84,.78-4.25,1.59-6.81,2.45-5.55,1.88-11.3,3.83-12.83,5.9h-.01v.02c-.16,2.77-2.63,4.29-5.02,5.76-.28,.17-.56,.35-.84,.52-1.35,.86-3.43,2-5.63,2.62h-.02s-.15,.42-.15,.42c-.51,2.21-1.8,6.27-3.53,11.32-.94-.38-1.9-.78-2.85-1.2-2.53-2.19-4.37-6.92-5.59-10.05-.18-.46-.35-.89-.49-1.27-.51-1.25-1.02-2.54-1.08-3.92-.06-1.89,.8-3.69,1.54-5.28,.61-1.27,1.23-2.6,2.19-3.66,1.34-1.49,3.26-2.37,4.96-3.16,.93-.43,1.79-1.08,2.62-1.71,1.19-.92,2.43-1.87,3.89-2.12,.03,0,.06-.03,.06-.06-.01-.03-.03-.06-.06-.06h-.01c-1.5,.26-2.75,1.22-3.96,2.14-.82,.63-1.67,1.27-2.59,1.7-.96,.44-1.98,.91-2.94,1.51,.39-.66,.63-1.5,.86-2.31,.26-.96,.53-1.95,1.05-2.66,.34-.44,.52-.83,.69-1.17,.2-.44,.36-.75,.71-.97,.96-.6,3.45-1.19,4.52-1.37,1.07-.18,2.33-.01,3.54,.15,.41,.06,.81,.1,1.22,.15,1.3,.13,2.58,.15,3.56-.39,.09-.07,8.7-6.78,10.47-7.86,7.34-4.39,12.76-9.28,18.01-14.02,5.9-5.31,11.52-10.38,19.37-14.38,.08,.08,.17,.17,.25,.25,.02,.02,.06,.02,.08,0s.02-.06,0-.08c-.08-.08-.16-.15-.22-.23,1.55-.79,3.21-1.54,4.96-2.24l.06-.02c.78-.3,1.59-.63,2.13-1.27,.47-.55,.68-1.27,.86-2.01,1.34-5.41,2.45-10.78,3.53-15.96,1.68-8.01,3.4-16.29,5.92-24.65,1.41-4.64,2-8.69,2.64-12.98,.33-2.14,.65-4.37,1.09-6.74,.08-.37,.15-.75,.21-1.14,1.34-7.23,3.16-17.12,9.44-21.4,5.37-3.66,11.53-4.43,17.52-2.25,0,0,.01,0,.02,.01,.56,.19,1.13,.43,1.69,.69,2.38,1.1,5.56,3.09,7.04,6.36,8.53,18.69,11.44,41.22,8.92,68.89-.43,4.69-1.53,9.33-2.59,13.83-.94,4.02-1.92,8.17-2.43,12.33-1.09,9.15-.92,17.63,.52,25.92,.49,2.89,1.19,5.82,1.88,8.63,1.18,4.92,2.4,10,2.6,15.14Z" 
	stroke="#fff" stroke-miterlimit="10"/>
	<path d="M356.22,282.94c-7.84,3.99-13.47,9.07-19.36,14.38-5.24,4.73-10.67,9.62-17.99,14.01-1.79,1.07-10.4,7.8-10.47,7.85-.93,.52-2.16,.52-3.43,.39,.59-3.96,1.09-8.18,1.52-12.51h.01v-.04c.3-3.05,.57-6.15,.79-9.26l.05-.71c.18-2.79,.38-5.67,1.07-8.42,2.19-8.8,9.79-16.35,19.33-19.24,1.91-.59,4.29-1.09,6.8-1.11h.01s.01,.01,.02,.01h.01s.01,0,.02-.01h.01c2.28-.01,4.68,.38,6.94,1.47,2.69,1.32,4.84,3.45,6.91,5.52,2.16,2.14,4.7,4.65,7.77,7.66Z" 
	stroke="#fff" stroke-miterlimit="10"/>
	<path d="M359.46,382.44l-.51-.03c-4.73-.26-10.6-.6-14.75-2.3-2.59-1.07-4.97-2.67-7.02-4.07-3.7-2.58-7.57-5.52-11.21-8.53,3.13-5.52,5.48-9.93,6.33-12.11,2.17-5.55,5.3-14.4,7.71-22.67,2.03,5.37,3.78,9.6,6.17,13.98,.56,1.04,1.16,2.08,1.73,3.11,1.91,3.39,3.88,6.89,5.21,10.6,1.08,3,1.79,6.28,2.48,9.43,.94,4.33,1.91,8.75,3.86,12.59Z" 
	stroke="#fff" stroke-miterlimit="10"/>
	<path d="M306.37,307.06c-.43,4.32-.93,8.54-1.52,12.5-.38-.05-.78-.09-1.16-.15-1.23-.16-2.5-.31-3.57-.15-1.08,.18-3.6,.79-4.58,1.4-.37,.24-.54,.57-.74,1.01-.17,.34-.35,.71-.68,1.15-.53,.73-.8,1.72-1.07,2.69-.25,.89-.49,1.78-.92,2.45h0s-.01,.02-.01,.02c-.69,.44-1.33,.93-1.88,1.54-.97,1.08-1.6,2.41-2.21,3.69-.75,1.6-1.61,3.41-1.54,5.32,.05,1.4,.59,2.76,1.07,3.95,.16,.38,.33,.81,.51,1.27,1.18,3.05,2.95,7.56,5.38,9.88-11.28-4.95-22.47-11.75-31.18-17.27-1.72-1.09-3.32-2.35-4.74-3.76-.83-.83-1.57-1.78-2.28-2.69-.87-1.11-1.77-2.26-2.87-3.22l-.07-.07-.02,.09c-.19,.8-.38,1.61-.56,2.4-.25,1.08-.49,2.19-.79,3.29-.52,1.97-1.09,3.88-1.68,5.69-1.71,5.22-3.94,10.2-6.63,14.82-3.19,5.49-6.98,10.52-10.26,14.72-1.68,2.16-3.62,4.16-5.5,6.11l-.47,.5c-2.77,2.86-5.75,5.85-9.7,9.7-3.58,3.5-7.36,7.12-11.24,10.78-3.9,3.68-7.38,6.9-10.65,9.86-1.68,1.51-3.09,2.77-4.44,3.94-.28,.26-.59,.52-.88,.76-.34,.28-.66,.57-1,.87-.43,.37-.9,.73-1.36,1.07-.57,.42-1.17,.86-1.68,1.35-.93,.89-1.68,1.98-2.23,2.84-1.5,2.31-2.31,4.58-2.43,6.78-.1,1.77,.41,3.54,.89,5.28,.69,2.41,1.38,4.91,.43,7.34-.69,1.76-2.25,3.24-4.39,4.19-2.7,1.2-5.96,1.67-8.51,1.94h-.05c-2.94,.32-5.99,.63-8.43,2.58-3.21,2.54-7.09,4.62-10.91,5.85-3.09,1-5.68,1.65-8.44,.29-1.2-.58-2.35-.85-3.45-1.1-1.1-.25-2.24-.52-3.43-1.1-.54-.26-1.14-.48-1.71-.7-1.81-.68-3.52-1.32-3.58-3.08-.1-3.22,4.55-5.7,7.48-6.53,3.92-1.08,7.11-3.65,10.22-6.12,1.01-.81,2.05-1.64,3.1-2.41,5.01-3.67,9.02-6.95,11.36-12.93,.24-.59,.49-1.17,.8-1.74,1.13-2.22,2.63-4.26,4.08-6.24,.63-.86,1.27-1.73,1.88-2.61s1.22-1.76,1.83-2.64c1.6-2.3,3.24-4.67,4.82-7.04,1.43-2.14,2.77-4.3,3.89-6.13,1.77-2.88,3.53-5.82,5.24-8.67,1.41-2.35,2.87-4.79,4.32-7.18,2.91-4.77,6.33-10.31,10.07-15.5,1.08-1.5,2.18-3,3.25-4.47,3.08-4.2,6.26-8.54,9.07-13.03,2.5-3.99,4.76-8.22,6.96-12.31,3.56-6.63,7.23-13.47,11.94-19.46,8.89-11.31,20.63-17.36,31.46-16.21,3.8,.41,7.49,1.68,11.05,2.91,5.55,1.91,11.46,3.93,17.18,5.87,5.7,1.95,11.6,3.96,17.13,5.86Z" 
	stroke="#fff" stroke-miterlimit="10"/>
	<path d="M391.24,186.51c-2.46-.96-5.02-1.95-7.79-3.09-.33-.15-.65-.29-.97-.45l-.17-.08c-1.16-.55-2.51-1.19-3.79-1.89-.01-.01-.02-.02-.03-.02-.82-.45-1.54-1.07-2.23-1.68-.18-.15-.35-.3-.52-.45-.74-.63-1.71-1.46-2.64-2.35-.99-.96-1.73-1.79-2.36-2.62-.74-.99-1.23-1.86-1.5-2.72-.3-.96-.49-1.99-.57-3.07-.09-1.28-.02-2.68,.18-4.26,.23-1.61,.47-2.95,.81-4.19,.18-.69,.46-1.36,.74-2.03,.1-.26,.2-.51,.3-.77l.66-1.68c1.59-4.13,3.32-8.97,3.7-14.05,.18-2.36,.08-4.94-.32-7.65-.4-2.85-1.06-5.22-1.96-7.27-2.45-5.52-7.53-10.01-13.93-12.33-5.88-2.14-13.29-2.84-19.81-1.89-10.63,1.56-18.26,6.15-23.32,14.05-2.52,3.94-4.67,12.98-3.5,17.55,1.24,4.83,1.52,8.89,1.78,12.81,.21,2.99,.4,5.83,1,8.9,1.44,7.43,5.92,14.07,8.58,18.03,1.53,2.27,5.69,5.42,8.82,5.42,.17,0,.33,0,.49-.02,1.36-.16,2.46-.55,3.49-1.1,.02,0,.05-.01,.07-.03,.9-.48,1.77-1.08,2.71-1.77,.34-.25,.7-.51,1.07-.77,.82-.56,1.64-1.15,2.46-1.76,1.28-.93,2.55-1.9,3.8-2.88,2.42-1.92,4.93-4.06,6.85-6.68,1.47-2,3.22-5.16,3.17-8.88,0-.02,.03-.06,.06-.06,.03,0,.06,.02,.06,.06,.05,3.75-1.71,6.93-3.2,8.94-1.92,2.62-4.44,4.77-6.87,6.69-1.24,.99-2.5,1.95-3.78,2.87l.1,.25c2.6,6.58,3.67,9.29,3.67,16.73,0,.03-.02,.06-.06,.06-.02,0-.06-.02-.06-.06,0-7.41-1.07-10.13-3.66-16.68l-.09-.23c-.8,.6-1.6,1.17-2.4,1.72-.37,.26-.73,.51-1.07,.75-.96,.68-1.81,1.29-2.73,1.78h-.01c-5.03,3.99-10.4,9.05-14.77,13.91-1.87,2.08-3.93,4.55-4.67,7.47-1.23,4.74,1.14,9.68,3.61,13.88,2.73,4.68,6.57,9.91,9.98,14.45,.1-1.56,.18-2.93,.16-3.74-.1-4.96-.27-5.41-1.16-7.88-.32-.89-.71-1.99-1.24-3.65-.01-.03,.01-.07,.03-.08,.03,0,.07,.01,.08,.04,.52,1.64,.91,2.75,1.24,3.63,.89,2.49,1.05,2.94,1.16,7.92,.05,1.86-.38,6.58-.7,10.02-.12,1.36-.24,2.54-.29,3.27-.63,8.61,1.55,13.38,3.15,16.86,.73,1.61,1.37,2.99,1.51,4.34,2.3-.01,4.71,.38,6.99,1.49,2.71,1.32,4.87,3.47,6.94,5.55,2.16,2.14,4.71,4.67,7.8,7.68,1.58-.8,3.24-1.55,5.02-2.26l.05-.02c.76-.3,1.56-.62,2.09-1.25,.44-.53,.64-1.23,.82-1.96,1.34-5.41,2.45-10.78,3.53-15.96,1.68-8.01,3.4-16.29,5.93-24.66,1.4-4.62,2-8.67,2.63-12.96,.33-2.15,.65-4.37,1.1-6.75,.07-.37,.13-.75,.2-1.14,1.34-7.25,3.17-17.17,9.48-21.47,5.16-3.51,11.05-4.38,16.81-2.54-4.42-2.18-8.47-3.75-12.75-5.4Zm-23.57-29.66c-.73,1.89-1.65,3.18-2.82,3.98-.7,.47-1.63,.79-2.55,.79-.74,0-1.49-.2-2.1-.69-.02-.02-.02-.06-.01-.08,.02-.02,.06-.03,.08-.01,1.34,1.05,3.3,.74,4.53-.11,1.15-.78,2.05-2.06,2.78-3.92,.25-.63,.45-1.28,.66-1.91,.29-.9,.6-1.83,1-2.72,.28-.61,.61-1.2,.93-1.77,.39-.71,.8-1.44,1.11-2.19,.65-1.6,.72-3.12,.19-4.28-.83-1.79-3.23-2.7-5.32-2.03-1.8,.57-3.36,2.21-4.2,4.35-.01,.02-.03,.03-.07,.02-.03-.01-.05-.03-.03-.07,.83-2.18,2.43-3.84,4.26-4.42,2.15-.69,4.6,.25,5.46,2.09,.55,1.18,.48,2.73-.19,4.37-.31,.77-.72,1.5-1.11,2.19-.33,.57-.65,1.17-.93,1.77-.41,.88-.71,1.81-1,2.72-.2,.62-.42,1.27-.66,1.9Z" 
	stroke="#fff" stroke-miterlimit="10"/>
		${getCategoryCardSvg(category, '60%', '30%', 35)}
    </g>
</svg>`;
}

function getSupineDecubitus({ height_px, classes, bloodStyle, category, offset }: PictoOptions) {
	const left = offset ? -0.44 * height_px : 0;
	const top = offset ? -0.5 * height_px : 0;
	return `<svg style="position: relative;left: ${left}px; top:${top}px;" class="body_picto ${classes}" width="${height_px}" viewBox="0 0 600 600" fill="black" xmlns="http://www.w3.org/2000/svg">
    <path style="${bloodStyle}; transform-origin:50% 60%;" class="blood" d="M253.59,335.59s-30.72-2.98-38.99,0c-8.27,2.98-37.81,12.18-33.09,21.37,4.73,9.19,38.99,15.76,48.45,15.76s21.27,14.44,37.81,14.44,52.66-10.5,69.46-11.82c16.8-1.31,54.93-6.94,54.18-14.63-.75-7.69-22.57-17.33-37.66-16.45-15.09,.88-21.46-10.34-36.59-8.67-15.13,1.67-45.82,1.17-63.58,0Z" 
fill= "#d11c1c"/>
<path d="M581.61,295.92c-.01-2.06-.54-4.73-1.92-6.04-.54-.51-1.18-.76-1.89-.76h-.18c-1.83,.12-2.97,1.87-4,3.66-4,7.02-8.49,14.35-13.96,20.02,0,.01-.01,.01-.03,.03-4.77,4.97-10.28,8.66-16.87,9.79l-1.05,.18c-4.38,.74-9.33,1.59-13.67,1.78l-12.58,.3c-.26-.04-25.19-3.8-35.68-5.8-7.43-1.42-15-2.74-22.33-4.01-5.32-.93-10.82-1.88-16.22-2.87-5.42-.99-11.71-2.17-17.82-3.53-3.4-.74-6.77-1.78-10.04-2.77-4.05-1.23-8.23-2.51-12.47-3.27-4.44-.8-10.32-1.83-16.31-2.73-15.05-2.26-28.6-3.82-41.45-4.74-6.94-.5-12.64-.73-17.81-.73h-.93c-8.3,.05-17.38,1.12-26.17,2.16-9.93,1.18-20.2,2.4-29.32,2.12-3.49-.1-4.94-.88-6.61-1.75-1.37-.72-2.91-1.53-5.92-2.05-.03,0-.05-.04-.05-.08,.01-.03,.05-.05,.08-.05,3.02,.52,4.57,1.35,5.95,2.06,1.66,.88,3.1,1.63,6.56,1.74,9.11,.27,19.38-.94,29.31-2.12,8.79-1.03,17.89-2.1,26.18-2.16h.93c5.19,0,10.88,.24,17.82,.73,12.84,.93,26.39,2.48,41.46,4.74,5.98,.9,11.85,1.93,16.31,2.73,4.23,.77,8.43,2.04,12.48,3.27,3.27,.99,6.64,2.03,10.02,2.78,6.12,1.36,12.4,2.52,17.81,3.51,5.41,.99,10.91,1.95,16.23,2.87,7.32,1.27,14.9,2.59,22.33,4.01,10.48,2,35.42,5.76,35.67,5.8l12.57-.3c4.33-.18,9.28-1.03,13.64-1.78l1.05-.17c6.53-1.12,12.03-4.8,16.8-9.72h0c-.2-6.89,1.29-12.13,4.66-16.53,3.38-4.4,5.53-12.75,5.11-19.87-.12-2.03-.68-5.44-3.11-5.44-.5,0-1.23,.95-2,2.23-.77,1.27-1.58,2.86-2.23,4.13-.6,1.16-1.06,2.08-1.32,2.43-3.35,4.52-6.18,7.5-8.92,10.37-2.74,2.87-5.58,5.85-8.91,10.36-3.76,5.1-7.96,10.17-14.26,11.42-7.11,1.42-14.44,.88-21.55,.34-4.52-.34-9.06-.68-13.58-1.02-3.62-.27-7.3-.5-10.86-.71-8.85-.54-17.98-1.1-26.93-2.46-11.25-1.72-29.7-7.34-41.92-11.07-1.1-.34-2.16-.67-3.15-.97-3.75-1.14-6.66-1.45-9.73-1.79-2.77-.31-5.64-.63-9.17-1.61-24.57-6.78-44.23-6.27-66.98-5.67-3.11,.08-6.32,.17-9.59,.24-4.08-.04-6.94,.22-9.96,.5-3.36,.31-7.15,.67-13.34,.67h-.2c-3.21,0-7.07-.37-11.54-.78-8.65-.82-19.42-1.84-30.48-.55-5.45,.64-10.37,1.39-15.13,2.12-6.13,.93-11.92,1.82-17.56,2.22-16.03,1.16-25.07,1.02-25.17,1.02-5.33,.85-13.34,.5-18.23-.8-2-.52-3.4-1.05-4.64-1.5-1.91-.71-3.57-1.32-6.7-1.72-7.25-.93-15.72-.14-23.86,2.21-4.52,1.31-8.95,3.88-13.24,6.36-2.78,1.61-5.66,3.28-8.48,4.55-4.02,1.8-8.45,2.34-12.74,2.86l-4.05,.48c-.67,.08-1.32,.12-1.83-.21-.81-.54-.81-1.7-.72-2.64,.25-2.76,.05-4.98-.16-7.34-.1-1.2-.21-2.43-.27-3.79-.01-.34-.03-.69-.03-1.06-.05-2.44-.13-5.49-2.3-6.85-.76-.47-1.66-.55-2.67-.6-1.23-.05-2.42-.14-3.58-.22-4.22-.3-8.21-.57-12.19,.41-.03,0-.05-.01-.07-.04-.2-.37-.37-.74-.52-1.12-.18-.43-.38-.89-.63-1.32l-.05-.08c-.57-1.01-1.23-2.13-2.34-2.13-.08,0-.16,0-.24,.01-.57,.08-1.57,.68-2.09,1.01l-.08,.04c-1.08,.67-2.21,1.49-3.31,2.3-1.1,.81-2.23,1.65-3.32,2.3l-.84,.38h-.01c-1.92,.3-3.7,.26-5.41,.21-2.77-.07-5.38-.13-8.11,1.25-5.46,2.74-12.83,7.43-16.96,14.14-5.19,8.43-6.59,23.21-3.11,32.95,2.99,8.4,11.26,15.27,20.57,17.12,12.49,2.46,25.96-2.57,32.76-12.24,.67-.94,1.18-1.92,1.67-2.86,1.19-2.27,2.31-4.42,5.2-5.27,2.1-.61,3.82-.63,5.46-.65,1.69-.01,3.4-.04,5.51-.69,.74-2.85,2.03-5.03,3.99-6.78,2.76-2.46,6.95-4.17,12.84-5.24,.03,0,.07,.03,.08,.05,0,.04-.03,.08-.05,.08-12.05,2.17-15.46,6.89-16.73,11.9,.01,0,.03,.01,.03,.03,.01,.03-.01,.07-.05,.08-.13,.5-.24,1.01-.33,1.5-1.36,7.68,2.78,14.66,5.38,18.14,1.58,2.12,4.09,3.23,6.52,4.3,.55,.25,1.12,.5,1.67,.76,2.6,1.22,8.7,2.57,11.54,2.87,4.19,.46,6.89,.88,9.5,1.27,3.48,.52,6.47,.98,12.07,1.41,.29,.04,28.75,4.27,34.03,4.27,4.57,0,46.41-3.72,51.64-4.48,6.27-.91,14.2-.69,17.72-.34,1.37,.14,4.73,1.16,8.27,2.25,4.17,1.27,8.47,2.57,9.96,2.57,2.89,0,5.53-1.49,8.58-3.21,.73-.42,1.5-.85,2.29-1.27,.98-.52,1.92-.98,2.85-1.41,2.51-1.2,4.87-2.34,7.03-4.47,.59-.57,1.08-1.2,1.5-1.89,0-.01,.01-.03,.01-.04,.47-.78,.84-1.66,1.14-2.69,.1-.35,.25-.77,.41-1.2,.64-1.8,1.42-4.06,.4-5.14-1.45-1.53-2.98-1.48-8.3-.5-2.16,.41-4.48,2-6.73,3.53-1.19,.82-2.33,1.59-3.37,2.14-.6,.31-1.18,.63-1.74,.94-3.72,2.06-6.66,3.7-9.76,.31l-.67-.68h-.01c-.65-1.61,.22-3.38,1.42-4.33,1.07-.84,2.51-1.29,4.52-1.45,.54-.04,1.07-.07,1.59-.08,1.05-.04,2.13-.08,3.18-.29,1.02-.2,2.87-.77,3.87-2.31-4.02-.64-8.11-.89-12.18-.73-2.69,.1-6.21,.39-9.41,1.76-1.45,.63-2.82,1.46-4.16,2.27-.61,.37-1.24,.76-1.88,1.11l-2.38,1.2h-.03c-6.59,.64-13.16,.31-21.98-1.08-10.52-1.66-30.71-1.29-38.31-1.15-1.33,.03-2.3,.04-2.82,.04-.88,0-2.46-.52-4.56-1.36-2.09-.84-4.69-2.01-7.59-3.32-6.01-2.69-13.48-6.05-20.34-8.22-1.32-.43-3.62-1.01-6.05-1.62-3.95-.99-8.43-2.12-10.54-3.01-.04-.01-.05-.05-.04-.08,.01-.04,.05-.05,.09-.04,2.1,.89,6.57,2.01,10.52,3.01,2.44,.6,4.74,1.19,6.06,1.61,6.86,2.18,14.35,5.54,20.36,8.23,5.79,2.61,10.37,4.66,12.1,4.66,.52,0,1.48-.01,2.82-.04,7.6-.14,27.81-.51,38.34,1.15,8.79,1.4,15.35,1.72,21.94,1.08l2.37-1.18c.63-.37,1.25-.74,1.87-1.12,1.33-.81,2.7-1.65,4.17-2.27,3.23-1.39,6.74-1.67,9.46-1.78,4.1-.16,8.23,.09,12.3,.74,.03,0,.04,.01,.05,.04,0,.01,0,.04-.01,.07-.99,1.65-2.94,2.25-4,2.46-1.06,.21-2.14,.25-3.2,.29-.51,.03-1.06,.04-1.58,.08-1.99,.14-3.41,.6-4.46,1.42-1.16,.9-2.01,2.61-1.38,4.14l.67,.67c3.02,3.31,5.92,1.7,9.59-.34,.56-.3,1.14-.63,1.74-.94,1.05-.55,2.17-1.32,3.37-2.13,2.26-1.54,4.59-3.14,6.77-3.55,5.38-.99,6.94-1.03,8.41,.54,1.08,1.14,.27,3.42-.38,5.27-.14,.43-.29,.85-.39,1.2-.29,.99-.65,1.84-1.08,2.61,23.39-2.29,47.86-5.15,68.43-10.52,1.32-.34,2.64-.69,3.97-1.05,10.74-2.86,21.85-5.81,33.05-5.23,5.04,.27,10.17,2.27,16.66,4.8,11.32,4.4,26.71,10.39,51.59,10.39,.77,0,1.57,0,2.37-.01,5.03-.08,13.94-1.29,24.25-2.72,10.3-1.41,21.96-3.02,31.58-3.67h4.59c4.74,0,14.19,2.42,17.68,5,1.01,.74,1.89,1.49,2.76,2.21,2.29,1.91,4.27,3.57,7.4,4.51,4.16,1.24,9.71,.31,11.82-3.84,1.37-2.72,.85-5.7,.3-8.86-.37-2.1-.74-4.27-.52-6.36,.48-4.39,3.54-7.81,6.48-11.12,1.59-1.78,3.23-3.62,4.48-5.61,4.17-6.64,4.1-15.22,4.06-22.11Zm-511.3,21.51c-3.37,1.01-5.61,4.29-7.4,6.91-2.03,2.95-4.29,5.91-7.66,6.7-.51,.12-1.03,.18-1.54,.18-2.95,0-5.84-1.88-6.9-4.68-1.24-3.29,.29-7.3,3.38-8.95,.04-.01,.08,0,.09,.03,.01,.04,0,.08-.03,.09-2.99,1.59-4.52,5.61-3.33,8.78,1.2,3.18,4.99,5.2,8.3,4.42,3.32-.78,5.57-3.71,7.58-6.65,1.8-2.64,4.05-5.93,7.46-6.96,.04-.01,.08,.01,.09,.05,0,.03-.01,.07-.05,.08Z" 
style="stroke:#fff; stroke-miterlimit:10;"/>
		${getCategoryCardSvg(category, '15%', '52%', 40)}
    </g>
</svg>`;
}

function getProneDecubitus({ height_px, classes, bloodStyle, category, offset }: PictoOptions) {
	const left = offset ? -0.44 * height_px : 0;
	const top = offset ? -0.55 * height_px : 0;
	return `<svg style="position: relative; left: ${left}px; top:${top}px;" class="body_picto ${classes}" width="${height_px}" viewBox="0 0 600 600" fill="black" xmlns="http://www.w3.org/2000/svg">
    <g class="ventral_position">
        <path style="${bloodStyle}  transform-origin:50% 43%;" class="blood"d="M220.99,346.22s-30.72-2.98-38.99,0c-8.27,2.98-37.81,12.18-33.09,21.37,4.73,9.19,38.99,15.76,48.45,15.76s21.27,14.44,37.81,14.44,52.66-10.5,69.46-11.82c16.8-1.31,54.93-6.94,54.18-14.63-.75-7.69-22.57-17.33-37.66-16.45-15.09,.88-21.46-10.34-36.59-8.67-15.13,1.67-45.82,1.17-63.58,0Z" 
		fill="#d11c1c"/>
		<g>
		<path d="M106.03,348.7c-1.16,1.29-3.81,3.22-5.4,3.92-1.92,.85-3.93,1.56-5.92,2.23-4,1.35-8.08,2.41-12.23,3.2-6.67,1.26-13.48,1.8-20.27,1.59-7.52-.23-15.36-3.2-21.98-6.66-4.72-2.47-9.09-5.82-12.04-10.26-6.19-9.31-5.52-22.59-.78-32.38,2.07-4.28,5.18-8.03,9.24-10.55,10.46-6.52,24.53-5.31,34.52,1.34,.99,.66,2.12,1.23,3.45,1.72-.28,.09-.56,.23-.85,.37-2.24,1.11-2.11,3.65-1.74,5.73,0,.03,.03,.05,.07,.05,.04-.01,.07-.04,.05-.08-.36-2.03-.49-4.51,1.67-5.58,.34-.17,.66-.31,1.01-.44,1.01-.33,1.99-.38,2.98-.15,1.19,.29,2.37,.84,3.5,1.64,.32,.21,.62,.45,.95,.73,1.55,1.31,2.96,3.05,4.27,5.29,.69,1.18,1.07,2.33,1.45,3.45,.62,1.83,1.21,3.57,3.01,4.95,1.01,.77,2.19,1.19,3.33,1.6,.29,.09,.57,.2,.85,.31,1.96,.74,3.45,1.8,4.68,3.36,.78,.99,1.46,2.1,2.1,3.16,.15,.24,.29,.48,.44,.72,2.27,3.69,4.19,7.07,5.27,11.02,.85,3.14,.97,6.85-1.62,9.72Z" 
		stroke="#fff" stroke-miterlimit="10"/>
		<path d="M576.14,343.75c-.33,1.19-1.22,2.17-1.99,3.05-2.6,2.92-5.85,6.54-10.15,7.67-2.8,.73-5.76,.31-8.61-.09-1.99-.28-4.06-.57-6.07-.48-2.2,.09-4.38,.65-6.49,1.19-1.74,.45-3.54,.92-5.36,1.11-4.08,.45-8.3-.45-11.86-2.53-2.88-1.68-6.03-5.01-5.5-8.89,.66-4.69,6.22-7,11.19-7.61,3.67-.44,7.64,.07,11.47,.56,6.43,.84,13.09,1.68,18.63-1.88,1.01-.65,1.99-1.42,2.93-2.18,1.22-.97,2.47-1.95,3.81-2.69,.01,0,.03,0,.04-.01h0c1.1-.61,2.28-1.03,3.54-1.15,.41-.04,.95-.05,1.35,.23,.48,.32,.65,.9,.8,1.53,.66,2.73,1.31,5.46,1.98,8.2,.31,1.25,.64,2.67,.28,3.99Z" 
		stroke="#fff" stroke-miterlimit="10"/>
		<path d="M555.15,326.08c-.28,0-.56,0-.84,.01-.76,.01-1.55,.05-2.31,.09-4.14,.2-8.43,.4-12.2-1.33-1.78-.82-3.37-2.04-4.91-3.22-1.78-1.37-3.59-2.76-5.7-3.54-3.16-1.15-6.88-.76-9.73,1.05-1.15,.74-1.94,1.74-2.69,2.72-1.06,1.38-2.08,2.69-4.07,2.98-3.01,.45-5.94-.23-8.41-.94l-1.26-.49-.41-.11c-6.22-1.72-13.26-3.66-19.89-4.28-7.98-.76-22.2,.23-29.77,.98,6.92,.99,13.75,2.63,20.37,4.85,5.23,1.75,10.27,4.11,15.15,6.39,4.08,1.91,8.32,3.89,12.63,5.49,6.62,2.48,14.07,2.21,21.3,1.98,.98-.04,2-.07,3-.09h.01c1.83-.84,3.91-1.35,5.9-1.59,3.69-.44,7.67,.07,11.5,.56,6.42,.84,13.04,1.68,18.54-1.86,1.01-.65,1.99-1.42,2.93-2.17,1.21-.95,2.44-1.92,3.78-2.67-2.59-3.05-7.36-4.81-12.9-4.81Zm-24.54,5.04h-.01c-3.69-.56-7.11-2.39-9.62-5.15h-.01s-.31-.74-.31-.74c-.01-.04,0-.08,.03-.09,.04-.01,.08,0,.09,.04l.31,.72c2.49,2.73,5.88,4.54,9.52,5.09,.04,0,.07,.04,.07,.08-.01,.03-.04,.05-.07,.05Z" 
		stroke="#fff" stroke-miterlimit="10"/>
		<path d="M525.56,353.79c-2.9-1.71-6.11-5.09-5.57-9.02,.4-2.77,2.45-4.73,5.11-5.99-.9,.03-1.82,.05-2.71,.08-2.19,.08-4.39,.15-6.59,.15-5.08,0-10.12-.4-14.76-2.12-4.31-1.62-8.54-3.59-12.63-5.5-4.88-2.28-9.92-4.64-15.13-6.39-6.78-2.28-13.77-3.93-20.87-4.92h-.01c-2.75-.38-5.5-.68-8.28-.86-7.98-.53-13.7,.64-19.75,1.88-4.51,.93-9.16,1.88-14.91,2.1t-.03,0c-.77,.04-1.55,.05-2.36,.05-4.2,0-20.16-3.91-33.58-7.32-13.32-3.38-25.72-5.2-37.92-5.57-2.41-.08-5.08,.01-7.9,.09-6.37,.21-12.96,.42-18.18-1.11-4.15-1.22-8.49-3.14-13.1-5.17-9.26-4.08-18.83-8.32-27.49-7.02h-.01s-.07-.03-.07-.05c0-.04,.01-.07,.05-.08,8.71-1.29,18.3,2.93,27.57,7.03,4.6,2.03,8.95,3.95,13.09,5.16,5.2,1.54,11.78,1.33,18.14,1.11,2.83-.08,5.49-.17,7.92-.09,12.2,.37,24.61,2.19,37.94,5.57,13.41,3.41,29.35,7.32,33.54,7.32,.7,0,1.39-.01,2.07-.04-12.76-5.4-28.13-9.43-43.01-13.34-21.33-5.61-41.47-10.91-53.66-19.71-2.41-1.75-5-3.34-7.65-4.73-10.76-5.62-22.82-8.04-33.99-6.78-11.14,1.25-21.48,6.66-31.5,11.9-1.13,.6-2.27,1.18-3.38,1.76-4.2,2.18-9.43,4.88-14.95,5.92-4.27,.8-9.2,1.05-15.09,.76-5.68-.29-12.12-2-17.81-3.51-.48-.12-.96-.25-1.42-.37-5.42-1.43-9.02-2.68-11.9-3.69-5.41-1.9-8.87-3.1-18.61-3.54h-.03c-2.64-.12-5.73-.17-9.46-.17-1.5,0-3.1,.01-4.81,.03-.04,0-.07-.03-.07-.07-.01-.03,.03-.07,.05-.07,5.8-.07,10.32-.01,13.97,.13-.5-.21-1.01-.45-1.53-.68-3.86-1.71-7.85-3.5-11.98-4.39-3.17-.68-6.43-.86-9.77-1.01-3.42-.16-6.71-.16-9.44,1.35-1.37,.77-2.65,1.95-3.91,3.62-1.74,2.28-2.35,4.73-2.96,7.1-.41,1.6-.84,3.28-1.6,4.88-1.55,3.24-4.44,5.88-7.41,8.21,1.41-.64,2.77-1.35,4.14-2.06,3.67-1.91,7.17-3.73,10.81-3.73,.53,0,1.06,.04,1.59,.12,.04,.01,.07,.04,.05,.08,0,.04-.03,.05-.07,.05-4.18-.65-8.13,1.42-12.32,3.58-1.5,.77-3.01,1.55-4.58,2.24h-.01s-.03,.03-.04,.03c-2.93,1.31-6.06,2.29-9.6,2.31h-.05c-4.43,0-8.77-1.76-12.59-3.33-.61-.25-1.26-.49-1.98-.72,1.47,1.29,2.8,2.97,4.06,5.12,.7,1.19,1.09,2.35,1.47,3.47,.61,1.82,1.18,3.53,2.96,4.88,.99,.76,2.16,1.18,3.3,1.58,.28,.11,.56,.21,.84,.32,1.99,.74,3.49,1.83,4.73,3.4,.8,.99,1.47,2.1,2.12,3.17,.15,.24,.29,.48,.44,.7,2.27,3.7,4.23,7.08,5.28,11.07,.01,.05,.03,.11,.04,.17-.28-2.52-.2-5.27,.25-8.17,.53-3.42,1.54-6.8,2.51-10.07,.74-2.45,1.5-4.99,2.04-7.53,.01-.03,.04-.05,.08-.05,.04,.01,.05,.05,.05,.08-.56,2.55-1.31,5.09-2.04,7.55-.98,3.26-1.99,6.63-2.51,10.05-1.07,6.92-.05,12.9,2.93,17.29,1.43,2.1,4.05,4.4,7.07,5.9h.01s.04,.01,.04,.03c1.54,.76,3.17,1.3,4.8,1.5,2.73,.32,6.1,.04,9.35-.23,1.39-.11,2.73-.23,3.99-.29h.03c.69-.03,1.35-.05,1.98-.05h.33c3.63,.04,7.04,.27,10.3,.66h.03c1.14,.15,2.27,.31,3.38,.49,1.37,.23,2.73,.54,4.06,.85,1.45,.33,2.94,.69,4.44,.92,3.05,.46,6.13,1.03,9.15,1.67,4.23,.9,8.45,2.11,12.52,3.28,3.28,.93,6.67,1.9,10.04,2.71,3.34,.8,6.88,1.5,10.23,.6h.01s.07,.01,.07,.04c.01,.04-.01,.08-.04,.09-1.13,.29-2.28,.42-3.44,.42-2.29,0-4.63-.49-6.86-1.02-3.38-.81-6.76-1.78-10.04-2.72-4.08-1.15-8.29-2.36-12.52-3.26-3.02-.65-6.1-1.21-9.14-1.67-1.5-.23-3.01-.58-4.46-.92-1.33-.31-2.69-.62-4.06-.85-1.1-.19-2.21-.34-3.34-.49h-.01c-1.27,.31-2.53,.41-3.78,.5-1.23,.11-2.51,.2-3.75,.5-.32,.08-.65,.16-.99,.16-.11,0-.21,0-.32-.03-.49-.09-3.29-1.45-3.81-1.75-1.26,.07-2.6,.19-3.99,.29-3.26,.27-6.64,.54-9.38,.23-1.64-.2-3.3-.74-4.85-1.53h-.01c-.57-.13-1.74-.19-2.28-.08-1.92,.38-3.42-.01-5.01-.45-1.18-.31-2.4-.64-3.86-.64h-.12c-.44,0-1.06,.07-1.38,.48-.28,.37-.69,1.62-.64,2.07,.07,.49,.07,.98,.07,1.45-.01,1.13-.01,2.1,.85,2.84,4.56,3.89,8.78,7.14,14.18,7.28,.12,0,.24,.01,.36,.01,1.87,0,3.74-.41,5.56-.8,.21-.05,.44-.09,.65-.15,17.63-3.74,36.07-3.01,53.35,2.12,5.21,1.55,10.32,2.03,14.36,1.35,1.56-.25,3.08-.53,4.55-.78,2.73-.49,5.32-.94,8.2-1.35,1.18-.17,2.25-.44,3.29-.69,1.29-.32,2.6-.64,4.07-.77,2.77-.25,4.11-1.15,5.12-3.47,.97-2.2,.2-5.4-1.27-7.68h0c-.41-.65-.88-1.22-1.37-1.67-2.44-2.24-5.58-3.58-8.63-4.87-.41-.17-.82-.36-1.23-.53-2.06-.89-4.07-1.94-6.02-2.96-1.87-.98-3.82-1.99-5.8-2.86-4.01-1.75-7.98-3.25-11.84-4.44-9.04-2.81-17.17-4.02-24.85-3.69-.11,.01-11.05,.41-13.18-1.82-.03-.03-.03-.07,0-.09,.01-.03,.07-.03,.09,0,1.76,1.83,10.24,1.9,13.08,1.78,.82-.03,1.66-.05,2.48-.05,6.98,0,14.34,1.23,22.43,3.74,3.86,1.21,7.85,2.71,11.86,4.46,1.98,.88,3.93,1.88,5.81,2.86,1.94,1.02,3.95,2.07,6.01,2.96,.41,.17,.82,.34,1.23,.53,3.06,1.3,6.22,2.64,8.67,4.89,.49,.45,.95,1.02,1.37,1.66,2.39,.46,4.83,.95,7.18,1.43,9.81,1.98,19.95,4.03,30.11,4.03,.56,0,1.13-.01,1.68-.03,7.61-.17,15.25,.93,22.64,1.99,4.23,.61,8.62,1.25,12.97,1.63,9.26,.82,19.47,.58,31.22-.74,9.85-1.1,20.11-2.89,30.97-4.79,17.88-3.13,36.35-6.35,53.13-6.37,4.26,0,7.81-.66,11.26-1.29,4-.73,7.78-1.42,12.56-1.19,17.49,.82,77.76,5.54,78.35,5.6h10.91c.81,0,1.67,0,2.52,.11l.24,.04c1.67,.23,3.73,.52,5.28,.11-1.31-.42-2.57-.99-3.77-1.68Zm-366.52-44.79s-.03,0-.04-.01c-2.8-1.82-4.02-2.59-5.21-3.34-1.18-.76-2.4-1.53-5.23-3.36-.58-.37-1.19-.77-1.87-.97-.8-.24-1.7-.2-2.43-.19-1.41,.05-2.41,.25-3.49,.44-.89,.17-1.82,.33-3.01,.44-.04,0-.07-.03-.07-.07s.03-.07,.07-.07c1.18-.09,2.1-.27,2.98-.44,1.07-.19,2.1-.38,3.5-.44,.74-.03,1.66-.05,2.48,.19,.69,.21,1.3,.61,1.9,.99,2.83,1.82,4.05,2.6,5.24,3.36,1.18,.74,2.4,1.53,5.21,3.34,.03,.01,.04,.05,.01,.09-.01,.01-.03,.03-.05,.03Z" 
		stroke="#fff" stroke-miterlimit="10"/>
		</g>
		${getCategoryCardSvg(category, '18%', '52%', 40)}
    </g>
</svg>`;
}

function getRecoveryPosition({ height_px, classes, bloodStyle, category, offset}: PictoOptions) {
	const left = offset ? -0.5 * height_px : 0;
	const top = offset ? -0.5 * height_px : 0;
	return `<svg style="position: relative; left: ${left}px; top:${top}px;" class="body_picto ${classes}" width="${height_px}" viewBox="0 0 600 600" fill="black" xmlns="http://www.w3.org/2000/svg">
    <g class="pls_position">
        <path style="${bloodStyle} transform-origin:50% 40%;" class="blood" d="M233.9,342.9s-30.72-2.98-38.99,0c-8.27,2.98-37.81,12.18-33.09,21.37,4.73,9.19,38.99,15.76,48.45,15.76s21.27,14.44,37.81,14.44,52.66-10.5,69.46-11.82c16.8-1.31,54.93-6.94,54.18-14.63-.75-7.69-22.57-17.33-37.66-16.45-15.09,.88-21.46-10.34-36.59-8.67-15.13,1.67-45.82,1.17-63.58,0Z" 
fill="#d11c1c"/>
<g>
<path d="M578.04,284.25c-.08,3.01-.49,5.65-2.21,8.63-2.33,4.08-5.24,9.14-10.02,11.53-4.62,2.31-9.96,1.67-15.12,1.07-2.7-.32-5.49-.67-8.2-.57-2.98,.08-6.61,.36-10.44,.66-8.94,.69-19.06,1.47-26.6,.36h-1.57c-35.02,9.92-55.67,16.8-69.34,21.37-11.73,3.91-17.66,5.89-22.62,6.43-3.03-3.36-6.46-7.69-8.93-10.8-.55-.7-1.04-1.32-1.49-1.86-4.4-5.49-9.01-11.08-13.78-16.7,4.85,.63,11.14,.25,16.72-.1,2.76-.18,5.37-.34,7.69-.38,.92-.01,1.85-.03,2.77-.04,5.86-.07,11.93-.14,17.77-1.37,3.55-.74,7.05-1.92,10.43-3.07,2.61-.88,5.31-1.79,8.02-2.51,3.17-.83,6.46-1.4,9.66-1.95,6.29-1.11,13.76-2.31,21.5-2.94,.59-.06,1.16-.1,1.75-.14,4.62-.35,9.35-.53,14.03-.56l.34-.14c.95-.38,1.93-.83,2.97-1.3,4.41-1.99,9.78-4.43,18.5-4.43,.95,0,1.96,.03,3,.08,2.4,.15,7.69-1.16,13.8-2.68,7.1-1.75,15.15-3.74,20.31-3.8,.15,0,.31-.01,.46-.01,7.74,0,17.96,2.21,20.16,4.39,.29,.28,.43,.56,.43,.84Z" 
stroke="#fff" stroke-miterlimit="10"/>
<path d="M549.93,361.66c-1.2,1.46-3.12,2.4-4.99,2.44h-.21c-3.39,0-6.4-2.06-8.67-3.85-.48-.39-.97-.78-1.43-1.18-2.07-1.71-4.22-3.48-6.75-4.43-2.8-1.04-5.87-1.01-8.83-.98-1.3,.01-2.63,.03-3.94-.04-2.9-.17-5.65-.88-8.3-1.58-2.94-.77-5.98-1.58-9.25-1.61h-.08c-1.04,0-3.5,.15-5.07,.67l-1.57,.46c-2.98,.48-7.99,2.06-12.82,3.59-3.41,1.08-6.61,2.1-8.79,2.62-.41,.1-40.02,9.98-59.95,12.15-7.2,.78-13.93-2.54-21.33-6.64-10.19-5.63-22.23-13.65-33.38-22.08-5.2-3.95-10.22-7.97-14.76-11.91-6.88-5.96-13.17-12.09-18.68-18.26-5.03-5.62-9.18-11.5-13.86-18.61l-.17-.25c-2.12-3.21-6-9.11-10.31-9.11-.1,0-.21,.01-.31,.01-.04,0-.07,.04-.07,.07,0,.04,.04,.07,.07,.07,.11,0,.21-.01,.31-.01,4.25,0,8.1,5.87,10.2,9.05l.17,.25c4.68,7.1,8.83,12.99,13.87,18.62,5.51,6.17,11.8,12.3,18.69,18.27,4.51,3.91,9.47,7.9,14.63,11.81-16.97,2.44-30.8,3.8-43.5,4.27-3.53,.13-6.74,.13-9.82-.01-4.3-.2-7.82-.34-11.07-.43-8.51-.24-15.54-.2-22.14,.13-3.74,.18-7.37,.46-10.82,.84-9,.98-18.04,2.72-26.77,4.41-5.14,.98-10.47,2.02-15.72,2.87-1.04,.17-2.06,.34-3.1,.49-3.76,.6-7.62,1.22-11.43,2.1-.2,.04-.52,.14-.84,.24-.24,.07-.46,.14-.62,.17h-.01c-.1-.06-.18-.1-.28-.14l-.6-.28c-.34-.15-.69-.32-1.04-.48-3.36-1.57-6.84-3.18-10.62-3.56-3.07-.31-6.22,.14-8.93,.6-5.27,.88-10.72,1.99-15.98,3.05-9.54,1.95-19.28,3.94-28.95,4.79,.9-.43,2.05-.81,2.45-.94,18.54-5.63,36.13-13.94,52.27-24.69,3.77-2.52,7.12-5.3,10.65-8.24l.57-.48c1.67-1.37,3.15-2.97,4.58-4.5,.73-.8,1.5-1.61,2.27-2.4,.5-.5,1.01-.99,1.5-1.5,1.74-1.71,3.53-3.48,5.11-5.4,.78-.95,1.51-1.99,1.6-3.17,.07-1.04-.35-2.13-1.29-3.32-5.42-6.99-11.28-13.23-17.39-18.55-9.75-8.49-20.35-15.12-31.5-19.72l-1.35-.94c-2.05-1.44-4.02-2.82-5.98-4.11,7.85,.92,15.67,2.73,23.22,4.46,8.14,1.88,16.56,3.81,24.93,4.64,9.36,.91,17.71,.31,25.5-1.86,8.59-2.4,16.59-6.74,24.31-10.93,3.14-1.7,6.38-3.45,9.61-5.06,13.02-6.45,25.55-10.09,37.22-10.82,13.7-.85,26.63,2.24,36.39,8.74,8.77,5.86,16.05,13.92,23.08,21.71,1.47,1.64,3,3.32,4.51,4.96,7.83,8.49,15.64,17.32,23.11,26.13,4.79,5.66,9.46,11.31,13.89,16.84,.45,.55,.94,1.18,1.49,1.86,2.45,3.1,5.86,7.38,8.88,10.75-.03,0-.04,.03-.03,.06,0,.04,.03,.07,.07,.07,.03,0,.04,0,.07-.01,2.2,2.44,4.19,4.37,5.47,4.96h.03s.04,0,.04,0c1.67-1.05,23.29-6.39,36.01-6.57h2.44c3.11,.11,8.98-.34,13.72-.69,3.25-.24,5.83-.43,6.4-.36h.01l1.68-.53c4.26-1.37,8.35-4.05,11.55-7.51,3.9-4.23,10.97-3.34,15.95-.27,2.44,1.5,4.64,3.43,6.75,5.31,2.17,1.91,4.4,3.88,6.91,5.41,2.62,1.58,5.54,2.69,8.35,3.77,2.62,.99,5.33,2.02,7.79,3.43,5.58,3.21,9.92,8.46,13.76,13.09,.9,1.09,2.03,2.45,2.28,4.04,.22,1.28-.18,2.59-1.11,3.71Z" 
stroke="#fff" stroke-miterlimit="10"/>
<path d="M211.07,370.6c-1.3,1.58-3,2.66-4.76,3.05-3.21,.7-6.92,1.65-10.15,3.32-3.05,1.58-6.35,3.18-9.88,3.94-5.89,1.25-11.97,.07-17.85-1.07-1.3-.25-2.65-.52-3.95-.74-4.22-.71-8.7-1.54-14.56-2.66-10.31-1.98-19.65-3.98-28.54-6.14-.91-.22-1.89-.34-2.97-.34-2,0-4.3,.39-6.94,1.18-.85,.25-2.56,.91-4.2,1.54-1.37,.53-2.68,1.04-3.39,1.26-4.97,1.61-8.91,1.82-13.48,2.06-1.96,.1-4.01,.21-6.26,.43-.21,.01-.41,.03-.59,.03-2.44,0-3.84-1.63-5.47-3.49-.5-.6-1.04-1.21-1.63-1.79-2.02-1.99-3.45-5.52-3.62-7.64-.08-1.11,.1-1.91,.55-2.35,.39-.39,.95-.56,1.74-.5,.74,.04,1.18,.74,1.56,1.36,.1,.15,.2,.31,.29,.45,.83,1.16,2.23,1.81,4.3,1.98,2.24,.18,4.15,.14,5.84-.1,.78-.11,1.54-.29,2.26-.48,.01,0,.03,0,.04-.01,.81-.21,1.56-.46,2.19-.67l.31-.1c.17-.06,.34-.13,.52-.18,.01,0,.03,0,.03-.01,.48-.15,.95-.29,1.43-.38,1.64-.28,3.01-.88,4.12-1.79,.88-.74,1.72-1.68,2.47-2.77,.04-.06,.08-.13,.14-.2,.21-.28,.42-.57,.34-.8-.06-.14-.21-.22-.46-.25-.7-.11-1.36,.2-1.81,.48-.49,.31-.95,.69-1.42,1.07-.14,.11-.28,.24-.43,.35-1.15,.91-2.35,1.89-3.45,3-.38,.38-.73,.76-1.01,1.19-.17,.06-.34,.11-.52,.17l-.29,.11c-.6,.2-1.32,.43-2.09,.64,.13-.69-.01-1.39-.14-2.07-.08-.43-.17-.85-.18-1.26v-.03c-.03-.42,.01-.83,.2-1.22,.14-.29,.34-.56,.55-.81,.43-.5,.9-.99,1.36-1.46,.21-.21,.42-.42,.62-.64,.5-.53,.95-1.11,1.4-1.67,.18-.22,.36-.45,.55-.67,.81-.99,1.81-2.09,3.11-2.68,1.64-.73,3.5-.56,5.31-.42,.31,.03,.62,.06,.93,.08,.11,0,.22,.01,.34,.01,.95,.07,1.93,.13,2.79,.53,.14,.07,.28,.15,.42,.24-.04,.01-.06,.06-.04,.1,.01,.03,.04,.04,.07,.04,0,0,.01,0,.03-.01,.03-.01,.06-.03,.08-.04,.56,.39,1.01,.87,1.36,1.28,.67,.8,1.39,1.53,1.93,2.09,1.7,1.72,3.43,3.32,5.14,4.74l.03,.03s.06,.04,.08,.06c.31,.25,.56,.46,.83,.66h.01s.03,.01,.03,.01c5.02,.39,10.1,.29,15.2-.14-.03,.01-.04,.06-.01,.08,.01,.03,.03,.04,.06,.04,.01,0,.03,0,.03-.01,.08-.04,.17-.1,.27-.14,9.8-.84,19.66-2.84,29.32-4.82,5.25-1.07,10.69-2.19,15.96-3.05,2.7-.46,5.84-.91,8.9-.6,3.77,.38,7.23,1.99,10.58,3.55,.35,.15,.69,.32,1.04,.48l.6,.28c.1,.04,.21,.1,.31,.14,3.76,1.74,7.64,3.53,11.13,5.8,1.13,.74,2.26,1.6,2.77,2.82,.81,1.93-.15,4.15-1.33,5.58Z"
 stroke="#fff" stroke-miterlimit="10"/>
<path d="M98.79,322.34c.6,10.3-9.12,22.93-12.74,26.36-.63,.6-1.35,1.35-2.16,2.2-6.01,6.31-17.21,18.06-38.27,14.18-7.85-1.44-14.87-6.47-19.24-13.8-2.91-4.88-4.43-10.33-4.43-15.54,0-2.58,.38-5.1,1.14-7.47,4.2-13.05,14.29-21.48,30-25.06,3.53-.81,7.02-1.21,10.48-1.21,5.54,0,10.99,1.02,16.31,3.08,.01,.01,.03,.03,.06,.04h.06c4.68,1.79,9.28,4.4,13.76,7.78,3.11,2.34,4.81,5.52,5.03,9.43Z" 
stroke="#fff" stroke-miterlimit="10"/>
<path d="M213,308.96c-.08,1.15-.8,2.16-1.57,3.1-1.57,1.91-3.36,3.67-5.1,5.38-.49,.5-1.01,.99-1.5,1.5-.78,.78-1.54,1.6-2.28,2.4-1.43,1.53-2.9,3.12-4.55,4.5l-.57,.48c-3.55,2.93-6.88,5.7-10.65,8.21-16.12,10.75-33.69,19.04-52.23,24.69-.46,.14-1.84,.6-2.77,1.09-3.03,.27-6.04,.41-9.05,.41-2.16,0-4.3-.07-6.43-.24-.27-.2-.52-.39-.81-.63-.01-.03-.04-.04-.07-.07l-.03-.03c-1.72-1.4-3.45-3-5.14-4.72-.55-.56-1.25-1.29-1.93-2.07-.34-.41-.77-.87-1.3-1.25,.87-.34,1.71-.74,2.52-1.12,2.65-1.26,5.16-2.45,8.17-1.58,3.59,1.01,11.35,1.95,12.71,1.08,6.11-4.97,13.17-8.63,20-12.16,1.07-.55,2.14-1.11,3.21-1.67,6.71-3.52,11.88-8.1,16.77-14.87,1.54-2.13,2.8-4.18,4.01-6.17,2.05-3.32,3.99-6.47,6.84-9.18,.45-.43,.91-.84,1.42-1.25,.03-.03,.04-.07,.01-.1-.03-.03-.07-.03-.1-.01-.49,.39-.95,.8-1.4,1.23-.13-.08-.24-.15-.36-.22-1.36-.78-2.91-1.4-4.48-1.81-9.46-2.38-17.64-6.73-24.41-10.66-1.23-.71-2.45-1.44-3.49-2.05l-.83-.49c-3.67-2.17-7.46-4.41-11.29-6.42-2.87-1.51-5.86-2.91-8.73-4.27-1.28-.6-2.58-1.22-3.87-1.84-1.43-.69-2.51-1.6-3.28-2.75-.03-.04-.07-.04-.1-.03-.04,.03-.04,.07-.03,.1,.8,1.19,1.89,2.1,3.35,2.8,1.29,.62,2.59,1.23,3.87,1.84,2.87,1.36,5.84,2.76,8.72,4.26,3.84,2.02,7.62,4.26,11.29,6.42l.83,.49c1.04,.62,2.26,1.33,3.49,2.06,6.78,3.94,14.98,8.28,24.44,10.68,1.57,.39,3.1,1.01,4.46,1.79,.11,.07,.21,.14,.32,.2-2.82,2.7-4.74,5.84-6.77,9.14-1.22,1.98-2.48,4.04-4.01,6.15-4.89,6.75-10.05,11.32-16.73,14.83-1.07,.56-2.13,1.12-3.21,1.67-6.82,3.53-13.89,7.19-20.01,12.18-1.29,.83-9.12-.13-12.58-1.11-3.05-.87-5.59,.32-8.28,1.6-.83,.39-1.7,.8-2.59,1.15-.17-.11-.34-.21-.52-.29-.87-.41-1.86-.48-2.83-.55-.11,0-.22-.01-.35-.01-.29-.03-.6-.06-.91-.08-1.82-.15-3.71-.31-5.38,.43-1.33,.6-2.34,1.71-3.17,2.7-.18,.22-.36,.46-.55,.69-.43,.56-.9,1.14-1.39,1.65-.21,.22-.42,.43-.63,.64-.45,.48-.91,.95-1.35,1.47-.22,.27-.43,.52-.57,.84-.17,.36-.22,.76-.21,1.15-5.58-4.23-1.89-12.02-1.5-12.82,.03-.04,.04-.07,.04-.07,2.02-2.24,4.57-5.62,6.71-9.37,.87-1.53,1.79-3.34,2.59-5.28,.57-.04,6.28-.45,8.42,0h.01s.07-.03,.07-.06c.01-.04-.01-.08-.06-.08-2.12-.43-7.58-.07-8.39-.01,1.29-3.19,2.23-6.78,2.03-10.2-.22-3.97-1.93-7.17-5.09-9.54-4.34-3.28-8.84-5.83-13.45-7.65,2.37,.13,4.54,.1,6.66,.07,2.23-.03,4.55-.04,7.08,.1,1.74,.1,6.99-.01,8.31-1.68,1.19-1.51,1.23-8.86,1.28-14.21,0-.53,.01-1.05,.01-1.53v-2.96c0-7.89,0-16.05,4.25-22.63,5.23-8.11,15.53-11.64,26.88-9.21,7.72,1.65,13.97,4.93,20.43,9.16,.01,.01,.04,.03,.06,.03,2.03,1.35,4.06,2.77,6.19,4.27l1.36,.92c11.15,4.61,21.73,11.24,31.47,19.72,6.11,5.31,11.95,11.55,17.38,18.53,.91,1.16,1.32,2.23,1.26,3.22Z" 
stroke="#fff" stroke-miterlimit="10"/>
</g>
		${getCategoryCardSvg(category, '22%', '52%', 40)}
     </g>
	</svg>`;
}


function getPainIcon(pain: number, overview: HumanOverview): string {
	if (overview.looksDead || overview.gcs.total < 7) {
		return "/patient/pain/pain_svg/unconscious_dead.svg";
	}

	let painLevel : string;

	if (pain <= 2) {
		painLevel = 'no';
	} else if (pain <= 4) {
		painLevel = 'low';
	} else if (pain <= 6) {
		painLevel = 'medium';
	} else if (pain <= 8) {
		painLevel = 'high';
	} else {
		painLevel = 'horrible';
	}

	let consciousness;

	const glasgow = overview.gcs.total;

	if (glasgow < 11) { 
		consciousness = 'HS_conscious';
	}else if(glasgow < 14){
		consciousness = 'confused';
	}else {
		consciousness = 'alert';
	}

	return "/patient/pain/pain_svg/" + consciousness + '_' + painLevel + 'Pain.svg';
}

function convertMeterToPixel(m: number, resolution: number) {
	return convertMeterToMapUnit(m) / resolution;
}

function getBodyPicto(overview: HumanOverview, resolution: number = 0.05, offset: boolean = true): string {
	const { className: classes, bloodRatio } = getPicoClassNames(overview);

	const bloodStyle = `transform: scale(${bloodRatio});`;

	const height_px = convertMeterToPixel(overview.height_cm / 100, resolution);

	const options: PictoOptions = { height_px: Math.max(height_px, 20), classes, bloodStyle, category: overview.category, offset };

	switch (overview.position) {
		case 'STANDING':
			return getStanding(options);
		case 'SITTING':
			return getSitting(options);
		case 'SUPINE_DECUBITUS':
			return getSupineDecubitus(options);
		case 'PRONE_DECUBITUS':
			return getProneDecubitus(options);
		case 'RECOVERY':
			return getRecoveryPosition(options);
	}
}


export function getBodyPictoOffset(humanId: string): [number, number] {
	switch (getHumanPosition(humanId)) {
		case 'STANDING':
			return [0, 0];
		case 'SITTING':
			return [40, 20];
		case 'SUPINE_DECUBITUS':
			return [0, 0];
		case 'PRONE_DECUBITUS':
			return [0, 0];
		case 'RECOVERY':
			return [0, 0];
	}
}


const colorfulModel: Point[] = [
	{ x: 0.6, y: 0 },
	{ x: 0.85, y: 1 }
]


function getColorful(human: HumanBody) {
	const bloodRatio = human.state.vitals.cardio.totalVolume_mL / human.meta.initialBloodVolume_mL;

	return interpolate(bloodRatio, colorfulModel);
}


export function getOverview(human: (HumanBody & { category: Categorization | undefined })): HumanOverview {

	const looksDead = (human.state.vitals.cardiacArrest ?? 0) > 0;

	const category = getCategory(human.category?.category);

	return {
		height_cm: human.meta.height_cm,
		gcs: human.state.vitals.glasgow,
		position: human.state.variables.bodyPosition,
		colorful: looksDead ? 0 : getColorful(human),
		cyanosis: human.state.vitals.respiration.SaO2 < 0.85,
		looksDead: looksDead,
		totalExternalBloodLosses_ml: human.state.vitals.cardio.totalExtLosses_ml,
		arterialBloodLosses_mlPerMin: human.state.vitals.cardio.extArterialLossesFlow_mlPerMin,
		venousBloodLosses_mlPerMin: human.state.vitals.cardio.extVenousLossesFlow_mlPerMin,
		category: category?.category,
		rr: human.state.vitals.respiration.rr,
		tidalVolume_L: human.state.vitals.respiration.tidalVolume_L,
	};
}

export function getHumanPosition(humanId: string): BodyPosition {
	const human = getHuman(humanId);
	if (human != null) {
		return human.state.variables.bodyPosition;
	} else {
		return 'STANDING';
	}
}


export function getCategoryCard(): string {
	const id = I18n.toString(Variable.find(gameModel, 'currentPatient'));

	const output: string[] = [''];

	const human = getHuman(id);
	if (human != null) {
		const overview = getOverview(human);
		if (overview) {
			output.push(`<div class='cat_card ${overview.category}'>${getCategoryCardSvg(overview.category, 0, 0, 64)}</div>`);
		}
	} else {
		//output.push("<em>Error [patient not found]</em>");
	}
	return output.join("");
}

export function getVisualOverview(): string {
	const id = I18n.toString(Variable.find(gameModel, 'currentPatient'));

	const output: string[] = [''];

	const human = getHuman(id);
	if (human != null) {
		const overview = getOverview(human);
		if (overview) {
			output.push(`<div>${getBodyPicto(overview, 0.005, false)}</div>`);
		}
	} else {
		output.push('<em>Loading...</em>');
		//output.push("<em>Error [patient not found]</em>");
	}
	return output.join("");
}

export function getVisualOverviewForHumanId(id: string, resolution: number = 0.05): string {

	const output: string[] = [];

	const human = getHuman(id);
	if (human != null) {
		const overview = getOverview(human);
		if (overview) {
			output.push(getBodyPicto(overview, resolution));
		}
	}
	return output.join("");
}

/*
function getCyanosisPos(cyanosis: boolean, pallor: number): number {
	let pos = 50;
	if (cyanosis) {
		pos += (pallor * 0.5);
	}
	else {
		pos -= (pallor * 0.5);
	}
	return pos * .8;
}
*/

export function getVisualDetails(): string {

	const output: string[] = [];

	const human = getCurrentPatientBody();
	if (human != null) {
		const overview = getOverview(human);
		if (overview) {
			const painPath = getPainIcon(human.state.vitals.pain, overview);
			const painURL = Helpers.getFilePath(painPath);
			const labelP = getTranslation('pretriage-interface', 'face');
			output.push(`<div class='visualDetail_elem'><img width="48px" src='${painURL}' class="coloration_pain" style='display: block; background-color: ${getSkinColoration(overview.colorful, overview.cyanosis)}'><p>${labelP}</p></div>`);
			// DEPRECATED - Triangle cursor
			// const cursorPalor = (overview.colorful * 100 * 0.8) + 5;
			// const cursorCyan = getCyanosisPos(overview.cyanosis, (overview.colorful * 100)) + 5;
			// const labelC = getTranslation('pretriage-interface', 'coloration'); 
			//output.push(`<div class='visualDetail_elem'><p>${labelC}</p><div class='coloration_triangle'><div class='cyanosis'><div class='pallor'><div class='coloration_cursor' style='left:${cursorPalor}%; top:${cursorCyan}%'></div></div></div></div></div>`);
		}
	}
	return output.join("");
}

function getSkinColoration(colorful: number, cyanosis: boolean): string {
	const palorThreshold = .725;
	let color;

	// Threshold
	colorful < palorThreshold ? color = '#FFFFFF' : "";
	cyanosis ? color = "#59BBD3" : color = "#E5A0B3";

	return color;
}



export function getShadowMan() {
	// <svg width="482" height="649" viewBox="0 0 482 649" fill="none" xmlns="http://www.w3.org/2000/svg">
	//<path d="M386.415 324.936C383.439 323.051 379.766 321.025 373.387 314.006C369.56 309.816 364.264 306.883 358.697 304.962C357.692 304.613 356.609 304.299 355.72 303.705C353.903 302.518 353.594 300.073 353.091 298.222C352.589 296.407 352.202 294.521 351.661 292.705C350.579 289.038 349.573 283.207 349.573 273.464C349.573 250.382 344.316 230.442 341.532 225.065C338.749 219.687 336.971 215.566 333.723 193.741C330.437 171.916 336.739 175.513 333.723 149.148C330.708 122.783 308.286 118.139 298.235 116.043C288.183 113.948 267.656 106.301 263.674 103.542C261.702 102.18 261.393 83.3008 261.586 76.7009C264.64 72.4406 266.225 66.8184 267.346 61.9296C267.81 62.4883 268.815 63.501 269.743 63.5708C270.98 63.6407 272.836 60.1137 273.377 58.1931C273.957 56.2725 274.73 49.7773 273.841 47.3329C272.99 44.8885 270.942 46.8091 270.284 47.752C270.052 48.1012 269.55 48.4154 269.009 48.6948C269.202 45.4821 269.357 42.2695 269.898 39.0917C270.903 32.8061 270.439 26.7649 268.081 20.6887C263.132 7.94285 243.687 7.06984 241.02 7C238.314 7.06984 218.907 7.94285 213.92 20.7586C211.562 26.8347 211.098 32.8759 212.103 39.1616C212.605 42.3393 212.799 45.552 212.992 48.7646C212.451 48.4853 211.948 48.171 211.716 47.8218C211.059 46.8789 209.01 44.9583 208.16 47.4028C207.309 49.8472 208.082 56.3423 208.624 58.263C209.203 60.1836 211.02 63.7454 212.257 63.6407C213.185 63.5708 214.19 62.5581 214.654 61.9994C215.775 66.8883 217.36 72.5104 220.415 76.7707C220.608 83.4056 220.299 102.285 218.327 103.612C214.345 106.336 193.817 113.983 183.766 116.113C173.715 118.208 151.331 122.853 148.277 149.218C145.262 175.583 151.563 171.986 148.277 193.811C144.991 215.636 143.252 219.757 140.468 225.134C137.685 230.512 132.427 250.452 132.427 273.534C132.427 283.277 131.422 289.108 130.34 292.775C129.798 294.591 129.412 296.442 128.909 298.292C128.407 300.143 128.097 302.588 126.28 303.775C125.391 304.334 124.347 304.683 123.304 305.032C117.737 306.953 112.441 309.886 108.613 314.076C102.235 321.095 98.6007 323.121 95.5853 325.006C92.6086 326.892 93.5751 331.711 100.418 330.279C107.26 328.848 111.783 321.025 113.484 321.514C115.185 321.968 111.629 333.597 110.198 337.508C108.768 341.419 107.415 346.133 106.526 348.543C105.637 350.952 104.631 355.352 106.642 357.796C108.652 360.241 111.513 357.098 113.484 350.777C115.456 344.492 119.515 333.247 119.515 333.247C119.515 333.247 117.273 342.746 115.611 348.473C113.948 354.235 109.696 361.568 113.33 364.327C115.263 365.793 117.505 363.942 118.781 361.149C120.056 358.355 121.68 353.676 121.796 353.222C122.994 348.543 126.551 335.622 126.551 335.622C126.551 335.622 124.27 346.447 122.917 351.581C122.183 354.444 120.404 358.181 120.404 360.485C120.404 362.301 121.989 363.558 124.077 362.965C125.971 362.441 127.633 358.635 128.755 354.584C129.876 350.428 131.577 342.886 132.62 339.324C133.007 337.962 133.664 336.635 133.626 337.647C133.548 339.847 131.654 345.819 131.035 348.822C130.262 352.628 130.417 355.317 132.388 355.527C133.626 355.666 134.708 355.387 135.79 353.711C137.028 351.79 138.226 346.762 139.115 343.2C140.545 337.438 142.478 332.13 143.329 326.962C144.141 321.794 145.339 311.213 146.228 307.756C147.117 304.299 148.934 299.759 148.934 299.759H148.818C152.298 290.016 160.687 266.62 166.138 252.337C173.135 234.004 170.699 227.684 171.743 219.757C172.439 214.623 178.392 201.773 182.722 188.014C182.722 188.014 195.982 218.569 191.923 236.518C184.848 268.051 187.052 258.867 184.848 268.051C182.413 278.178 179.939 288.096 178.856 298.467C176.382 321.584 174.449 345.016 178.508 367.888C179.977 376.234 185.351 424.599 185.042 426.24C183.766 432.526 179.668 445.726 178.083 453.164C176.498 460.602 177.31 471.776 177.929 492.1C178.547 512.423 181.408 528.172 182.374 539.347C183.186 548.95 181.64 573.429 181.176 580.169C181.099 581.356 180.867 582.508 180.441 583.626C179.514 586.105 178.083 589.562 176.343 592.565C173.251 597.908 166.138 608 163.779 610.13C161.421 612.261 157.594 617.429 161.151 618.93C162.426 619.454 163.045 618.93 163.045 618.93C162.581 620.606 163.393 622.387 164.514 622.911C165.442 623.33 166.601 623.19 166.601 623.19C166.717 624.517 168.38 626.962 171.936 626.089C171.936 626.089 172.826 628.952 175.609 629.092C176.537 629.127 177.426 629.092 178.276 628.813C179.05 628.533 179.9 627.73 180.867 625.74C180.867 625.74 180.171 628.324 183.65 629.546C187.168 630.768 191.304 629.336 193.431 625.251C195.557 621.165 195.325 620.432 197.103 616.905C198.882 613.378 198.07 604.159 199.345 600.388C200.66 596.651 204.448 595.359 204.796 592.251C205.028 590.4 205.106 586.838 204.603 583.451C204.68 583.451 204.835 569.448 204.835 569.448L205.299 563.198C205.995 553.56 207.309 543.922 209.319 534.423C212.683 518.465 217.36 492.03 218.791 476.002C220.685 454.526 222.927 436.472 224.164 433.05C224.203 432.91 224.319 432.666 224.396 432.421C229.113 419.291 232.476 405.742 234.177 392.018C234.718 387.688 235.221 382.904 235.607 377.736C237.347 355.143 236.535 342.851 241.02 342.257C245.504 342.851 244.692 355.143 246.432 377.736C246.818 382.869 247.321 387.653 247.862 392.018C249.563 405.742 252.927 419.291 257.643 432.421C257.759 432.7 257.836 432.91 257.875 433.05C259.151 436.472 261.354 454.526 263.248 476.002C264.679 492.03 269.357 518.465 272.72 534.423C274.73 543.922 276.044 553.525 276.74 563.198L277.204 569.448C277.204 569.448 277.359 583.451 277.436 583.451C276.972 586.804 277.05 590.366 277.243 592.251C277.591 595.359 281.379 596.651 282.694 600.388C284.008 604.124 283.158 613.343 284.936 616.905C286.714 620.432 286.482 621.2 288.609 625.251C290.735 629.336 294.91 630.768 298.389 629.546C301.907 628.324 301.173 625.74 301.173 625.74C302.1 627.73 302.951 628.533 303.763 628.813C304.613 629.127 305.502 629.162 306.43 629.092C309.175 628.952 310.103 626.089 310.103 626.089C313.659 626.962 315.322 624.517 315.438 623.19C315.438 623.19 316.598 623.295 317.525 622.911C318.646 622.422 319.497 620.641 318.994 618.93C318.994 618.93 319.652 619.419 320.889 618.93C324.484 617.464 320.657 612.295 318.26 610.13C315.902 608 308.788 597.908 305.696 592.565C303.956 589.562 302.526 586.07 301.598 583.626C301.173 582.508 300.941 581.356 300.863 580.169C300.399 573.429 298.853 548.915 299.665 539.347C300.631 528.172 303.454 512.423 304.111 492.1C304.729 471.776 305.541 460.602 303.956 453.164C302.371 445.726 298.235 432.561 296.998 426.24C296.65 424.564 302.023 376.234 303.531 367.888C307.59 344.981 305.657 321.584 303.183 298.467C302.062 288.131 299.626 278.178 297.191 268.051C294.987 258.867 297.191 268.051 290.116 236.518C286.096 218.569 299.317 188.014 299.317 188.014C303.647 201.773 309.6 214.623 310.296 219.757C311.34 227.649 308.904 234.004 315.902 252.337C321.353 266.585 329.742 289.981 333.221 299.724H333.105C333.105 299.724 334.922 304.264 335.811 307.721C336.7 311.178 337.898 321.759 338.71 326.927C339.522 332.095 341.494 337.403 342.924 343.165C343.813 346.727 345.012 351.755 346.249 353.676C347.331 355.352 348.414 355.631 349.651 355.492C351.622 355.282 351.777 352.593 351.004 348.787C350.385 345.784 348.491 339.778 348.414 337.613C348.375 336.6 349.032 337.927 349.419 339.289C350.463 342.851 352.164 350.393 353.285 354.549C354.406 358.6 356.068 362.441 357.962 362.93C360.089 363.488 361.635 362.266 361.635 360.45C361.635 358.146 359.857 354.409 359.122 351.546C357.769 346.412 355.488 335.587 355.488 335.587C355.488 335.587 359.045 348.473 360.243 353.187C360.359 353.641 361.944 358.32 363.259 361.114C364.534 363.873 366.815 365.758 368.71 364.292C372.343 361.533 368.091 354.165 366.429 348.438C364.766 342.711 362.524 333.213 362.524 333.213C362.524 333.213 366.583 344.457 368.555 350.743C370.526 357.028 373.387 360.206 375.397 357.762C377.408 355.317 376.403 350.882 375.513 348.508C374.624 346.098 373.233 341.419 371.841 337.473C370.411 333.562 366.893 321.933 368.555 321.479C370.256 321.025 374.779 328.848 381.622 330.244C388.464 331.641 389.431 326.857 386.454 324.971L386.415 324.936Z" fill="#AAAAAA"/>
	//</svg>

	return `<svg viewBox="0 0 294 636" fill="none" width="100%" xmlns="http://www.w3.org/2000/svg">
<path d="M292.368 324.587C289.392 322.662 285.72 320.595 279.342 313.429C275.516 309.151 270.221 306.156 264.655 304.195C263.65 303.839 262.568 303.518 261.679 302.912C259.862 301.7 259.553 299.204 259.05 297.315C258.548 295.461 258.162 293.536 257.62 291.682C256.538 287.938 255.533 281.985 255.533 272.038C255.533 248.473 250.277 228.116 247.494 222.626C244.711 217.136 242.933 212.929 239.686 190.647C236.401 168.366 242.701 172.038 239.686 145.121C236.671 118.205 214.254 113.464 204.204 111.325C194.155 109.185 173.631 101.378 169.65 98.5615C167.679 97.1712 167.369 77.8969 167.563 71.1589C170.616 66.8095 172.201 61.0698 173.322 56.0787C173.785 56.6491 174.79 57.6829 175.718 57.7542C176.955 57.8255 178.81 54.2248 179.351 52.264C179.931 50.3032 180.704 43.6722 179.815 41.1766C178.965 38.6811 176.916 40.6419 176.259 41.6044C176.027 41.961 175.525 42.2818 174.984 42.567C175.177 39.2871 175.332 36.0073 175.873 32.7631C176.878 26.3459 176.414 20.1783 174.056 13.9751C169.109 0.962571 149.667 0.0713015 147 0C144.294 0.0713015 124.891 0.962571 119.905 14.0464C117.548 20.2496 117.084 26.4172 118.089 32.8344C118.591 36.0786 118.784 39.3584 118.978 42.6383C118.437 42.3531 117.934 42.0322 117.702 41.6757C117.045 40.7132 114.997 38.7524 114.146 41.2479C113.296 43.7435 114.069 50.3745 114.61 52.3353C115.19 54.2961 117.006 57.9325 118.243 57.8255C119.171 57.7542 120.176 56.7204 120.64 56.15C121.761 61.1411 123.345 66.8808 126.399 71.2302C126.592 78.0039 126.283 97.2781 124.312 98.6328C120.331 101.414 99.8066 109.221 89.7572 111.396C79.7079 113.535 57.3287 118.276 54.2752 145.193C51.2604 172.109 57.5606 168.437 54.2752 190.719C50.9899 213.001 49.2505 217.207 46.4676 222.697C43.6847 228.188 38.4281 248.544 38.4281 272.109C38.4281 282.056 37.4232 288.01 36.341 291.753C35.7998 293.607 35.4133 295.496 34.9109 297.386C34.4084 299.275 34.0992 301.771 32.2826 302.983C31.3936 303.553 30.35 303.91 29.3064 304.266C23.7406 306.227 18.4454 309.222 14.6189 313.5C8.24137 320.666 4.60814 322.734 1.59333 324.659C-1.38283 326.584 -0.416547 331.504 6.42476 330.042C13.2661 328.58 17.7883 320.594 19.4889 321.094C21.1896 321.557 17.6337 333.429 16.2036 337.422C14.7735 341.415 13.4207 346.227 12.5317 348.687C11.6427 351.147 10.6378 355.639 12.6476 358.135C14.6575 360.63 17.5177 357.422 19.4889 350.969C21.4602 344.552 25.5186 333.072 25.5186 333.072C25.5186 333.072 23.2768 342.769 21.6148 348.616C19.9528 354.498 15.7011 361.985 19.3343 364.801C21.2669 366.299 23.5087 364.409 24.7842 361.557C26.0597 358.705 27.683 353.928 27.799 353.464C28.9972 348.687 32.5531 335.497 32.5531 335.497C32.5531 335.497 30.2727 346.548 28.9199 351.789C28.1855 354.712 26.4075 358.527 26.4075 360.88C26.4075 362.734 27.9923 364.017 30.0794 363.411C31.9734 362.876 33.6354 358.99 34.7563 354.855C35.8771 350.612 37.5778 342.912 38.6214 339.276C39.0079 337.885 39.665 336.53 39.6263 337.564C39.549 339.81 37.6551 345.907 37.0367 348.972C36.2637 352.858 36.4183 355.604 38.3895 355.817C39.6263 355.96 40.7086 355.675 41.7908 353.964C43.0277 352.003 44.2259 346.869 45.1148 343.233C46.5449 337.35 48.4775 331.931 49.3278 326.655C50.1395 321.379 51.3377 310.577 52.2267 307.047C53.1157 303.518 54.9323 298.883 54.9323 298.883H54.8163C58.295 288.937 66.6823 265.051 72.1322 250.469C79.1281 231.753 76.6931 225.3 77.7366 217.207C78.4324 211.967 84.3847 198.847 88.7137 184.801C88.7137 184.801 101.971 215.995 97.9127 234.32C90.8395 266.512 93.0426 257.136 90.8395 266.512C88.4044 276.851 85.9307 286.976 84.8485 297.564C82.3748 321.165 80.4422 345.087 84.5006 368.438C85.9694 376.958 91.3419 426.335 91.0327 428.01C89.7572 434.427 85.6602 447.903 84.0755 455.497C82.4908 463.091 83.3024 474.499 83.9209 495.248C84.5393 515.996 87.3995 532.075 88.3658 543.483C89.1775 553.287 87.6314 578.278 87.1676 585.159C87.0903 586.371 86.8584 587.547 86.4332 588.688C85.5056 591.219 84.0755 594.749 82.3362 597.815C79.244 603.269 72.1322 613.573 69.7744 615.747C67.4167 617.922 63.5902 623.198 67.1462 624.731C68.4217 625.266 69.0401 624.731 69.0401 624.731C68.5763 626.442 69.3879 628.261 70.5088 628.795C71.4365 629.223 72.596 629.081 72.596 629.081C72.712 630.435 74.374 632.931 77.9299 632.04C77.9299 632.04 78.8189 634.963 81.6018 635.106C82.5294 635.141 83.4184 635.106 84.2687 634.82C85.0418 634.535 85.8921 633.715 86.8584 631.683C86.8584 631.683 86.1627 634.321 89.6413 635.569C93.1586 636.817 97.2943 635.355 99.4201 631.184C101.546 627.013 101.314 626.264 103.092 622.663C104.87 619.063 104.058 609.651 105.334 605.801C106.648 601.986 110.436 600.667 110.784 597.494C111.016 595.605 111.093 591.968 110.59 588.51C110.668 588.51 110.822 574.214 110.822 574.214L111.286 567.833C111.982 557.993 113.296 548.153 115.306 538.456C118.669 522.164 123.345 495.176 124.775 478.813C126.669 456.887 128.911 438.456 130.148 434.962C130.187 434.82 130.303 434.57 130.38 434.32C135.095 420.916 138.458 407.083 140.159 393.073C140.7 388.652 141.202 383.768 141.589 378.491C143.328 355.425 142.516 342.876 147 342.27C151.484 342.876 150.672 355.425 152.411 378.491C152.798 383.732 153.3 388.616 153.841 393.073C155.542 407.083 158.905 420.916 163.62 434.32C163.736 434.606 163.813 434.82 163.852 434.962C165.128 438.456 167.331 456.887 169.225 478.813C170.655 495.176 175.332 522.164 178.694 538.456C180.704 548.153 182.018 557.957 182.714 567.833L183.178 574.214C183.178 574.214 183.332 588.51 183.41 588.51C182.946 591.932 183.023 595.569 183.216 597.494C183.564 600.667 187.352 601.986 188.666 605.801C189.98 609.615 189.13 619.027 190.908 622.663C192.686 626.264 192.454 627.048 194.58 631.184C196.706 635.355 200.88 636.817 204.359 635.569C207.876 634.321 207.142 631.683 207.142 631.683C208.069 633.715 208.92 634.535 209.731 634.82C210.582 635.141 211.471 635.177 212.398 635.106C215.142 634.963 216.07 632.04 216.07 632.04C219.626 632.931 221.288 630.435 221.404 629.081C221.404 629.081 222.564 629.188 223.491 628.795C224.612 628.296 225.462 626.478 224.96 624.731C224.96 624.731 225.617 625.23 226.854 624.731C230.448 623.234 226.622 617.958 224.226 615.747C221.868 613.573 214.756 603.269 211.664 597.815C209.925 594.749 208.494 591.184 207.567 588.688C207.142 587.547 206.91 586.371 206.832 585.159C206.369 578.278 204.823 553.251 205.634 543.483C206.601 532.075 209.422 515.996 210.079 495.248C210.698 474.499 211.509 463.091 209.925 455.497C208.34 447.903 204.204 434.463 202.967 428.01C202.619 426.299 207.992 376.958 209.499 368.438C213.558 345.051 211.625 321.165 209.152 297.564C208.031 287.012 205.596 276.851 203.161 266.512C200.957 257.136 203.161 266.512 196.087 234.32C192.068 215.995 205.286 184.801 205.286 184.801C209.615 198.847 215.568 211.967 216.263 217.207C217.307 225.264 214.872 231.753 221.868 250.469C227.318 265.015 235.705 288.901 239.184 298.848H239.068C239.068 298.848 240.884 303.482 241.773 307.012C242.662 310.541 243.86 321.343 244.672 326.619C245.484 331.896 247.455 337.315 248.885 343.197C249.774 346.833 250.972 351.967 252.209 353.928C253.291 355.639 254.374 355.924 255.611 355.782C257.582 355.568 257.736 352.823 256.963 348.937C256.345 345.871 254.451 339.739 254.374 337.529C254.335 336.495 254.992 337.849 255.379 339.24C256.422 342.876 258.123 350.577 259.244 354.819C260.365 358.955 262.027 362.876 263.921 363.375C266.046 363.946 267.592 362.698 267.592 360.844C267.592 358.491 265.815 354.677 265.08 351.753C263.727 346.513 261.447 335.461 261.447 335.461C261.447 335.461 265.003 348.616 266.201 353.429C266.317 353.892 267.902 358.67 269.216 361.522C270.491 364.338 272.772 366.263 274.666 364.766C278.299 361.949 274.047 354.427 272.385 348.58C270.723 342.734 268.481 333.037 268.481 333.037C268.481 333.037 272.54 344.516 274.511 350.933C276.482 357.35 279.342 360.595 281.352 358.099C283.362 355.604 282.357 351.076 281.468 348.652C280.579 346.192 279.188 341.415 277.796 337.386C276.366 333.393 272.849 321.521 274.511 321.058C276.212 320.595 280.734 328.58 287.575 330.006C294.417 331.432 295.383 326.548 292.407 324.623L292.368 324.587Z" fill="#AAAAAA"/>
</svg>`;
}


interface LocalizedBlocks {
	localized: {
		blockName: string;
		svg: string;
	}[];
	not_localized: string[];
}

function getBlockZone(blockName: BlockName): string | undefined {
	switch (blockName) {
		case 'HEAD':
			return `<rect x="75" y="-5" width="62" height="60" />`;
		case 'NECK':
			return `<rect x="65" y="55" width="85" height="15" />`;
		case 'LEFT_SHOULDER':
			return `<rect x="141" y="70" width="30" height="17" />`;
		case 'LEFT_ARM':
			return `<rect x="141" y="87" width="35" height="53" />`;
		case 'LEFT_ELBOW':
			return `<rect x="154" y="140" width="30" height="15" />`;
		case 'LEFT_FOREARM':
			return `<rect x="154" y="155" width="30" height="35" />`;
		case 'LEFT_WRIST':
			return `<rect x="163" y="190" width="20" height="10" />`;
		case 'LEFT_HAND':
			return `<rect x="165" y="200" width="40" height="40" />`;
		case 'RIGHT_SHOULDER':
			return `<rect x="41" y="70" width="30" height="17" />`;
		case 'RIGHT_ARM':
			return `<rect x="35" y="87" width="35" height="53" />`;
		case 'RIGHT_ELBOW':
			return `<rect x="35" y="140" width="30" height="15" />`;
		case 'RIGHT_FOREARM':
			return `<rect x="30" y="155" width="30" height="35" />`;
		case 'RIGHT_WRIST':
			return `<rect x="30" y="190" width="20" height="10" />`;
		case 'RIGHT_HAND':
			return `<rect x="8" y="200" width="40" height="40" />`;
		case 'THORAX_LEFT':
			return `<rect x="106" y="70" width="35" height="70" />`;
		case 'THORAX_RIGHT':
			return `<rect x="71" y="70" width="35" height="70" />`;
		case 'ABDOMEN':
			return `<rect x="65" y="140" width="83" height="40" />`;
		case 'PELVIS':
			return `<rect x="64" y="180" width="85" height="40" />`;
		case 'LEFT_THIGH':
			return `<rect x="107" y="220" width="41" height="50" />`;
		case 'LEFT_KNEE':
			return `<rect x="114" y="270" width="35" height="22" />`;
		case 'LEFT_LEG':
			return `<rect x="116" y="292" width="37" height="75" />`;
		case 'LEFT_ANKLE':
			return `<rect x="124" y="367" width="30" height="15" />`;
		case 'LEFT_FOOT':
			return `<rect x="125" y="382" width="37" height="35" />`;
		case 'RIGHT_THIGH':
			return `<rect x="65" y="220" width="41" height="50" />`;
		case 'RIGHT_KNEE':
			return `<rect x="64" y="270" width="35" height="22" />`;
		case 'RIGHT_LEG':
			return `<rect x="59" y="292" width="37" height="75" />`;
		case 'RIGHT_ANKLE':
			return `<rect x="60" y="367" width="30" height="15" />`;
		case 'RIGHT_FOOT':
			return `<rect x="50" y="382" width="37" height="35" />`;
	}
	return;
}

export function getLocalizedBlocks(blocks: string[]) {

	const result: LocalizedBlocks = {
		localized: [],
		not_localized: [],
	}
	const toDisplay: BlockName[] = blocks as BlockName[];

	//toDisplay = allBlocks;
	//toDisplay = extBlocks;
	//toDisplay  = [ "HEAD", "NECK",  "THORAX_LEFT", "THORAX_RIGHT", "LEFT_SHOULDER", "LEFT_FOREARM", "ABDOMEN", "PELVIS"];

	toDisplay.forEach(blockName => {
		const svg = getBlockZone(blockName as BlockName);
		if (svg) {
			result.localized.push({
				blockName,
				svg: `<svg width="220" height="470" viewBox="0 0 240 490" xmlns="http://www.w3.org/2000/svg">
${svg}</svg>`,
			});
		} else {
			result.not_localized.push(blockName);
		}
	});

	return result;
}

export function getLocalizedAfflictedBlocks() {
	return getLocalizedBlocks(getAfflictedBlocks());
}


export function getAllLocalizedBlocks() {
	const afflictedBlocks = getAfflictedBlocks();
	const forTreatments: string[] = Context.patientConsole.state.availableBlocks;

	const mAb = afflictedBlocks.reduce<Record<string, true>>((acc, cur) => {
		acc[cur] = true;
		return acc;
	}, {});

	const tB = forTreatments.reduce<Record<string, true>>((acc, cur) => {
		acc[cur] = true;
		return acc;
	}, {});

	const union = Helpers.uniq([...afflictedBlocks, ...forTreatments]);

	return getLocalizedBlocks(union).localized.map(lb => ({
		...lb,
		observable: mAb[lb.blockName],
		selectable: tB[lb.blockName],
	}));
}
